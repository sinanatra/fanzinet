import{a as hn,f as Nn,d as Se}from"../chunks/CsXbaW0u.js";import{i as At}from"../chunks/CujRvGow.js";import{c as er,o as Ur}from"../chunks/BY5szE3h.js";import{e as Ht,H as Dr,aS as rr,h as bn,P as Ot,a4 as Hr,I as Or,t as a,K as Yr,M as qr,O as Ie,Q as Yt,i as yt,af as Br,aJ as Xr,ar as Fe,c as Kn,aT as Dn,f as te,s as Vr,$ as Mt,y as Zr,aH as Ee,aU as Gr,aV as Wr,aO as on,ae as ze,aW as Kr,r as ir,p as or,aX as qt,q as Qr,aY as Jr,aZ as jr,aG as ni,d as ti,aD as ei,a_ as ri,aP as ii,l as b,ac as oi,a$ as ai,C as Tn,E as D,F as U,G as j,A as Lt,b0 as Jn,b1 as ar,D as $t,v as at,V as Z,as as li}from"../chunks/Bz0-R9yI.js";import{s as kn,e as yn}from"../chunks/BPKptqdW.js";import{s as tn,r as ui}from"../chunks/CF3Zwip9.js";import{p as en,i as Vn}from"../chunks/CgWTwZ29.js";function fi(n,t){return t}function ci(n,t,r){for(var e=[],i=t.length,u,l=t.length,c=0;c<i;c++){let f=t[c];or(f,()=>{if(u){if(u.pending.delete(f),u.done.add(f),u.pending.size===0){var v=n.outrogroups;ee(Ee(u.done)),v.delete(u),v.size===0&&(n.outrogroups=null)}}else l-=1},!1)}if(l===0){var g=e.length===0&&r!==null;if(g){var d=r,o=d.parentNode;ni(o),o.append(d),n.items.clear()}ee(t,!g)}else u={pending:new Set(t),done:new Set},(n.outrogroups??=new Set).add(u)}function ee(n,t=!0){for(var r=0;r<n.length;r++)ti(n[r],t)}var Ae;function lr(n,t,r,e,i,u=null){var l=n,c=new Map,g=(t&rr)!==0;if(g){var d=n;l=bn?Ot(Hr(d)):d.appendChild(Ht())}bn&&Or();var o=null,f=Mt(()=>{var E=r();return Zr(E)?E:E==null?[]:Ee(E)}),v,p=!0;function s(){h.fallback=o,si(h,v,l,t,e),o!==null&&(v.length===0?(o.f&Dn)===0?ir(o):(o.f^=Dn,lt(o,null,l)):or(o,()=>{o=null}))}var w=Dr(()=>{v=a(f);var E=v.length;let M=!1;if(bn){var C=Yr(l)===qr;C!==(E===0)&&(l=Ie(),Ot(l),Yt(!1),M=!0)}for(var x=new Set,R=Kn,T=Vr(),S=0;S<E;S+=1){bn&&yt.nodeType===Br&&yt.data===Xr&&(l=yt,M=!0,Yt(!1));var P=v[S],I=e(P,S),N=p?null:c.get(I);N?(N.v&&Fe(N.v,P),N.i&&Fe(N.i,S),T&&R.skipped_effects.delete(N.e)):(N=vi(c,p?l:Ae??=Ht(),P,I,S,i,t,r),p||(N.e.f|=Dn),c.set(I,N)),x.add(I)}if(E===0&&u&&!o&&(p?o=te(()=>u(l)):(o=te(()=>u(Ae??=Ht())),o.f|=Dn)),bn&&E>0&&Ot(Ie()),!p)if(T){for(const[k,B]of c)x.has(k)||R.skipped_effects.add(B.e);R.oncommit(s),R.ondiscard(()=>{})}else s();M&&Yt(!0),a(f)}),h={effect:w,items:c,outrogroups:null,fallback:o};p=!1,bn&&(l=yt)}function it(n){for(;n!==null&&(n.f&Jr)===0;)n=n.next;return n}function si(n,t,r,e,i){var u=(e&jr)!==0,l=t.length,c=n.items,g=it(n.effect.first),d,o=null,f,v=[],p=[],s,w,h,E;if(u)for(E=0;E<l;E+=1)s=t[E],w=i(s,E),h=c.get(w).e,(h.f&Dn)===0&&(h.nodes?.a?.measure(),(f??=new Set).add(h));for(E=0;E<l;E+=1){if(s=t[E],w=i(s,E),h=c.get(w).e,n.outrogroups!==null)for(const N of n.outrogroups)N.pending.delete(h),N.done.delete(h);if((h.f&Dn)!==0)if(h.f^=Dn,h===g)lt(h,null,r);else{var M=o?o.next:g;h===n.effect.last&&(n.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),Yn(n,o,h),Yn(n,h,M),lt(h,M,r),o=h,v=[],p=[],g=it(o.next);continue}if((h.f&qt)!==0&&(ir(h),u&&(h.nodes?.a?.unfix(),(f??=new Set).delete(h))),h!==g){if(d!==void 0&&d.has(h)){if(v.length<p.length){var C=p[0],x;o=C.prev;var R=v[0],T=v[v.length-1];for(x=0;x<v.length;x+=1)lt(v[x],C,r);for(x=0;x<p.length;x+=1)d.delete(p[x]);Yn(n,R.prev,T.next),Yn(n,o,R),Yn(n,T,C),g=C,o=T,E-=1,v=[],p=[]}else d.delete(h),lt(h,g,r),Yn(n,h.prev,h.next),Yn(n,h,o===null?n.effect.first:o.next),Yn(n,o,h),o=h;continue}for(v=[],p=[];g!==null&&g!==h;)(d??=new Set).add(g),p.push(g),g=it(g.next);if(g===null)continue}(h.f&Dn)===0&&v.push(h),o=h,g=it(h.next)}if(n.outrogroups!==null){for(const N of n.outrogroups)N.pending.size===0&&(ee(Ee(N.done)),n.outrogroups?.delete(N));n.outrogroups.size===0&&(n.outrogroups=null)}if(g!==null||d!==void 0){var S=[];if(d!==void 0)for(h of d)(h.f&qt)===0&&S.push(h);for(;g!==null;)(g.f&qt)===0&&g!==n.fallback&&S.push(g),g=it(g.next);var P=S.length;if(P>0){var I=(e&rr)!==0&&l===0?r:null;if(u){for(E=0;E<P;E+=1)S[E].nodes?.a?.measure();for(E=0;E<P;E+=1)S[E].nodes?.a?.fix()}ci(n,S,I)}}u&&Qr(()=>{if(f!==void 0)for(h of f)h.nodes?.a?.apply()})}function vi(n,t,r,e,i,u,l,c){var g=(l&Gr)!==0?(l&Wr)===0?on(r,!1,!1):ze(r):null,d=(l&Kr)!==0?ze(i):null;return{v:g,i:d,e:te(()=>(u(t,g??r,d??i,c),()=>{n.delete(e)}))}}function lt(n,t,r){if(n.nodes)for(var e=n.nodes.start,i=n.nodes.end,u=t&&(t.f&Dn)===0?t.nodes.start:r;e!==null;){var l=ei(e);if(u.before(e),e===i)return;e=l}}function Yn(n,t,r){t===null?n.effect.first=r:t.next=r,r===null?n.effect.last=t:r.prev=t}function ur(n){var t,r,e="";if(typeof n=="string"||typeof n=="number")e+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(t=0;t<i;t++)n[t]&&(r=ur(n[t]))&&(e&&(e+=" "),e+=r)}else for(r in n)n[r]&&(e&&(e+=" "),e+=r);return e}function pi(){for(var n,t,r=0,e="",i=arguments.length;r<i;r++)(n=arguments[r])&&(t=ur(n))&&(e&&(e+=" "),e+=t);return e}function hi(n){return typeof n=="object"?pi(n):n??""}function di(n,t,r){var e=n==null?"":""+n;return e===""?null:e}function gi(n,t,r,e,i,u){var l=n.__className;if(bn||l!==r||l===void 0){var c=di(r);(!bn||c!==n.getAttribute("class"))&&(c==null?n.removeAttribute("class"):n.className=c),n.__className=r}return u}function _i(n,t,r=t){var e=new WeakSet;ri(n,"input",async i=>{var u=i?n.defaultValue:n.value;if(u=Bt(n)?Xt(u):u,r(u),Kn!==null&&e.add(Kn),await ii(),u!==(u=t())){var l=n.selectionStart,c=n.selectionEnd,g=n.value.length;if(n.value=u??"",c!==null){var d=n.value.length;l===c&&c===g&&d>g?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=l,n.selectionEnd=Math.min(c,d))}}}),(bn&&n.defaultValue!==n.value||b(t)==null&&n.value)&&(r(Bt(n)?Xt(n.value):n.value),Kn!==null&&e.add(Kn)),oi(()=>{var i=t();if(n===document.activeElement){var u=ai??Kn;if(e.has(u))return}Bt(n)&&i===Xt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Bt(n){var t=n.type;return t==="number"||t==="range"}function Xt(n){return n===""?null:+n}function yi(n){return function(...t){var r=t[0];return r.stopPropagation(),n?.apply(this,t)}}var Le={},Vt={},Zt=34,ot=10,Gt=13;function fr(n){return new Function("d","return {"+n.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function Si(n,t){var r=fr(n);return function(e,i){return t(r(e),i,n)}}function $e(n){var t=Object.create(null),r=[];return n.forEach(function(e){for(var i in e)i in t||r.push(t[i]=i)}),r}function pn(n,t){var r=n+"",e=r.length;return e<t?new Array(t-e+1).join(0)+r:r}function Ei(n){return n<0?"-"+pn(-n,6):n>9999?"+"+pn(n,6):pn(n,4)}function wi(n){var t=n.getUTCHours(),r=n.getUTCMinutes(),e=n.getUTCSeconds(),i=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":Ei(n.getUTCFullYear())+"-"+pn(n.getUTCMonth()+1,2)+"-"+pn(n.getUTCDate(),2)+(i?"T"+pn(t,2)+":"+pn(r,2)+":"+pn(e,2)+"."+pn(i,3)+"Z":e?"T"+pn(t,2)+":"+pn(r,2)+":"+pn(e,2)+"Z":r||t?"T"+pn(t,2)+":"+pn(r,2)+"Z":"")}function mi(n){var t=new RegExp('["'+n+`
\r]`),r=n.charCodeAt(0);function e(f,v){var p,s,w=i(f,function(h,E){if(p)return p(h,E-1);s=h,p=v?Si(h,v):fr(h)});return w.columns=s||[],w}function i(f,v){var p=[],s=f.length,w=0,h=0,E,M=s<=0,C=!1;f.charCodeAt(s-1)===ot&&--s,f.charCodeAt(s-1)===Gt&&--s;function x(){if(M)return Vt;if(C)return C=!1,Le;var T,S=w,P;if(f.charCodeAt(S)===Zt){for(;w++<s&&f.charCodeAt(w)!==Zt||f.charCodeAt(++w)===Zt;);return(T=w)>=s?M=!0:(P=f.charCodeAt(w++))===ot?C=!0:P===Gt&&(C=!0,f.charCodeAt(w)===ot&&++w),f.slice(S+1,T-1).replace(/""/g,'"')}for(;w<s;){if((P=f.charCodeAt(T=w++))===ot)C=!0;else if(P===Gt)C=!0,f.charCodeAt(w)===ot&&++w;else if(P!==r)continue;return f.slice(S,T)}return M=!0,f.slice(S,s)}for(;(E=x())!==Vt;){for(var R=[];E!==Le&&E!==Vt;)R.push(E),E=x();v&&(R=v(R,h++))==null||p.push(R)}return p}function u(f,v){return f.map(function(p){return v.map(function(s){return o(p[s])}).join(n)})}function l(f,v){return v==null&&(v=$e(f)),[v.map(o).join(n)].concat(u(f,v)).join(`
`)}function c(f,v){return v==null&&(v=$e(f)),u(f,v).join(`
`)}function g(f){return f.map(d).join(`
`)}function d(f){return f.map(o).join(n)}function o(f){return f==null?"":f instanceof Date?wi(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:e,parseRows:i,format:l,formatBody:c,formatRows:g,formatRow:d,formatValue:o}}var xi=mi(","),Mi=xi.parse,Ci=Nn('<header class="bg-black border-b text-xs"><div class="mx-auto p-1"><div class="flex items-center justify-between gap-4"><div class="  text-white"> </div> <div class=" text-white/70 whitespace-nowrap">autore: <a target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800"> </a> · sviluppo: <a target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800"> </a></div></div></div></header>');function Pi(n,t){let r=en(t,"title",8,"fanzinet"),e=en(t,"subtitle",8,"analogikal knot map"),i=en(t,"version",8,"0.?"),u=en(t,"years",8,"(1980-1989)"),l=en(t,"author",8,"Paolo Palmacci"),c=en(t,"authorUrl",8,"https://www.paolopalmacci.it/"),g=en(t,"developer",8,"Giacomo Nanni"),d=en(t,"developerUrl",8,"https://giacomo.website/");var o=Ci(),f=D(o),v=D(f),p=D(v),s=D(p);U(p);var w=j(p,2),h=j(D(w)),E=D(h,!0);U(h);var M=j(h,2),C=D(M,!0);U(M),U(w),U(v),U(f),U(o),Tn(()=>{kn(s,`${r()??""}
        ${e()??""} v.${i()??""}
        ${u()??""}`),tn(h,"href",c()),kn(E,l()),tn(M,"href",d()),kn(C,g())}),hn(n,o)}class Zn{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let e=0;for(let i=0;i<this._n&&i<32;i++){const u=r[i],l=t+u,c=Math.abs(t)<Math.abs(u)?t-(l-u):u-(l-t);c&&(r[e++]=c),t=l}return r[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let r=this._n,e,i,u,l=0;if(r>0){for(l=t[--r];r>0&&(e=l,i=t[--r],l=e+i,u=i-(l-e),!u););r>0&&(u<0&&t[r-1]<0||u>0&&t[r-1]>0)&&(i=u*2,e=l+i,i==e-l&&(l=e))}return l}}function*Ri(n){for(const t of n)yield*t}function cr(n){return Array.from(Ri(n))}var Y=1e-6,$=Math.PI,rn=$/2,be=$/4,wn=$*2,Rn=180/$,sn=$/180,K=Math.abs,we=Math.atan,nt=Math.atan2,W=Math.cos,Ti=Math.exp,re=Math.log,Wt=Math.pow,Q=Math.sin,ut=Math.sign||function(n){return n>0?1:n<0?-1:0},qn=Math.sqrt,sr=Math.tan;function ki(n){return n>1?0:n<-1?$:Math.acos(n)}function ht(n){return n>1?rn:n<-1?-rn:Math.asin(n)}function En(){}function Pt(n,t){n&&De.hasOwnProperty(n.type)&&De[n.type](n,t)}var Ue={Feature:function(n,t){Pt(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,e=-1,i=r.length;++e<i;)Pt(r[e].geometry,t)}},De={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)n=r[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){ie(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)ie(r[e],t,0)},Polygon:function(n,t){He(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)He(r[e],t)},GeometryCollection:function(n,t){for(var r=n.geometries,e=-1,i=r.length;++e<i;)Pt(r[e],t)}};function ie(n,t,r){var e=-1,i=n.length-r,u;for(t.lineStart();++e<i;)u=n[e],t.point(u[0],u[1],u[2]);t.lineEnd()}function He(n,t){var r=-1,e=n.length;for(t.polygonStart();++r<e;)ie(n[r],t,1);t.polygonEnd()}function Qn(n,t){n&&Ue.hasOwnProperty(n.type)?Ue[n.type](n,t):Pt(n,t)}function oe(n){return[nt(n[1],n[0]),ht(n[2])]}function tt(n){var t=n[0],r=n[1],e=W(r);return[e*W(t),e*Q(t),Q(r)]}function St(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Rt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Kt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Et(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function ae(n){var t=qn(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function le(n,t){function r(e,i){return e=n(e,i),t(e[0],e[1])}return n.invert&&t.invert&&(r.invert=function(e,i){return e=t.invert(e,i),e&&n.invert(e[0],e[1])}),r}function ue(n,t){return K(n)>$&&(n-=Math.round(n/wn)*wn),[n,t]}ue.invert=ue;function Ni(n,t,r){return(n%=wn)?t||r?le(Ye(n),qe(t,r)):Ye(n):t||r?qe(t,r):ue}function Oe(n){return function(t,r){return t+=n,K(t)>$&&(t-=Math.round(t/wn)*wn),[t,r]}}function Ye(n){var t=Oe(n);return t.invert=Oe(-n),t}function qe(n,t){var r=W(n),e=Q(n),i=W(t),u=Q(t);function l(c,g){var d=W(g),o=W(c)*d,f=Q(c)*d,v=Q(g),p=v*r+o*e;return[nt(f*i-p*u,o*r-v*e),ht(p*i+f*u)]}return l.invert=function(c,g){var d=W(g),o=W(c)*d,f=Q(c)*d,v=Q(g),p=v*i-f*u;return[nt(f*i+v*u,o*r+p*e),ht(p*r-o*e)]},l}function Ii(n,t,r,e,i,u){if(r){var l=W(t),c=Q(t),g=e*r;i==null?(i=t+e*wn,u=t-g/2):(i=Be(l,i),u=Be(l,u),(e>0?i<u:i>u)&&(i+=e*wn));for(var d,o=i;e>0?o>u:o<u;o-=g)d=oe([l,-c*W(o),-c*Q(o)]),n.point(d[0],d[1])}}function Be(n,t){t=tt(t),t[0]-=n,ae(t);var r=ki(-t[1]);return((-t[2]<0?-r:r)+wn-Y)%wn}function vr(){var n=[],t;return{point:function(r,e,i){t.push([r,e,i])},lineStart:function(){n.push(t=[])},lineEnd:En,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var r=n;return n=[],t=null,r}}}function Ct(n,t){return K(n[0]-t[0])<Y&&K(n[1]-t[1])<Y}function wt(n,t,r,e){this.x=n,this.z=t,this.o=r,this.e=e,this.v=!1,this.n=this.p=null}function pr(n,t,r,e,i){var u=[],l=[],c,g;if(n.forEach(function(s){if(!((w=s.length-1)<=0)){var w,h=s[0],E=s[w],M;if(Ct(h,E)){if(!h[2]&&!E[2]){for(i.lineStart(),c=0;c<w;++c)i.point((h=s[c])[0],h[1]);i.lineEnd();return}E[0]+=2*Y}u.push(M=new wt(h,s,null,!0)),l.push(M.o=new wt(h,null,M,!1)),u.push(M=new wt(E,s,null,!1)),l.push(M.o=new wt(E,null,M,!0))}}),!!u.length){for(l.sort(t),Xe(u),Xe(l),c=0,g=l.length;c<g;++c)l[c].e=r=!r;for(var d=u[0],o,f;;){for(var v=d,p=!0;v.v;)if((v=v.n)===d)return;o=v.z,i.lineStart();do{if(v.v=v.o.v=!0,v.e){if(p)for(c=0,g=o.length;c<g;++c)i.point((f=o[c])[0],f[1]);else e(v.x,v.n.x,1,i);v=v.n}else{if(p)for(o=v.p.z,c=o.length-1;c>=0;--c)i.point((f=o[c])[0],f[1]);else e(v.x,v.p.x,-1,i);v=v.p}v=v.o,o=v.z,p=!p}while(!v.v);i.lineEnd()}}}function Xe(n){if(t=n.length){for(var t,r=0,e=n[0],i;++r<t;)e.n=i=n[r],i.p=e,e=i;e.n=i=n[0],i.p=e}}function Qt(n){return K(n[0])<=$?n[0]:ut(n[0])*((K(n[0])+$)%wn-$)}function Fi(n,t){var r=Qt(t),e=t[1],i=Q(e),u=[Q(r),-W(r),0],l=0,c=0,g=new Zn;i===1?e=rn+Y:i===-1&&(e=-rn-Y);for(var d=0,o=n.length;d<o;++d)if(v=(f=n[d]).length)for(var f,v,p=f[v-1],s=Qt(p),w=p[1]/2+be,h=Q(w),E=W(w),M=0;M<v;++M,s=x,h=T,E=S,p=C){var C=f[M],x=Qt(C),R=C[1]/2+be,T=Q(R),S=W(R),P=x-s,I=P>=0?1:-1,N=I*P,k=N>$,B=h*T;if(g.add(nt(B*I*Q(N),E*S+B*W(N))),l+=k?P+I*wn:P,k^s>=r^x>=r){var O=Rt(tt(p),tt(C));ae(O);var L=Rt(u,O);ae(L);var y=(k^P>=0?-1:1)*ht(L[2]);(e>y||e===y&&(O[0]||O[1]))&&(c+=k^P>=0?1:-1)}}return(l<-Y||l<Y&&g<-1e-12)^c&1}function hr(n,t,r,e){return function(i){var u=t(i),l=vr(),c=t(l),g=!1,d,o,f,v={point:p,lineStart:w,lineEnd:h,polygonStart:function(){v.point=E,v.lineStart=M,v.lineEnd=C,o=[],d=[]},polygonEnd:function(){v.point=p,v.lineStart=w,v.lineEnd=h,o=cr(o);var x=Fi(d,e);o.length?(g||(i.polygonStart(),g=!0),pr(o,Ai,x,r,i)):x&&(g||(i.polygonStart(),g=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),g&&(i.polygonEnd(),g=!1),o=d=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(x,R){n(x,R)&&i.point(x,R)}function s(x,R){u.point(x,R)}function w(){v.point=s,u.lineStart()}function h(){v.point=p,u.lineEnd()}function E(x,R){f.push([x,R]),c.point(x,R)}function M(){c.lineStart(),f=[]}function C(){E(f[0][0],f[0][1]),c.lineEnd();var x=c.clean(),R=l.result(),T,S=R.length,P,I,N;if(f.pop(),d.push(f),f=null,!!S){if(x&1){if(I=R[0],(P=I.length-1)>0){for(g||(i.polygonStart(),g=!0),i.lineStart(),T=0;T<P;++T)i.point((N=I[T])[0],N[1]);i.lineEnd()}return}S>1&&x&2&&R.push(R.pop().concat(R.shift())),o.push(R.filter(zi))}}return v}}function zi(n){return n.length>1}function Ai(n,t){return((n=n.x)[0]<0?n[1]-rn-Y:rn-n[1])-((t=t.x)[0]<0?t[1]-rn-Y:rn-t[1])}const Ve=hr(function(){return!0},Li,bi,[-$,-rn]);function Li(n){var t=NaN,r=NaN,e=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(u,l){var c=u>0?$:-$,g=K(u-t);K(g-$)<Y?(n.point(t,r=(r+l)/2>0?rn:-rn),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(c,r),n.point(u,r),i=0):e!==c&&g>=$&&(K(t-e)<Y&&(t-=e*Y),K(u-c)<Y&&(u-=c*Y),r=$i(t,r,u,l),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(c,r),i=0),n.point(t=u,r=l),e=c},lineEnd:function(){n.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function $i(n,t,r,e){var i,u,l=Q(n-r);return K(l)>Y?we((Q(t)*(u=W(e))*Q(r)-Q(e)*(i=W(t))*Q(n))/(i*u*l)):(t+e)/2}function bi(n,t,r,e){var i;if(n==null)i=r*rn,e.point(-$,i),e.point(0,i),e.point($,i),e.point($,0),e.point($,-i),e.point(0,-i),e.point(-$,-i),e.point(-$,0),e.point(-$,i);else if(K(n[0]-t[0])>Y){var u=n[0]<t[0]?$:-$;i=r*u/2,e.point(-u,i),e.point(0,i),e.point(u,i)}else e.point(t[0],t[1])}function Ui(n){var t=W(n),r=2*sn,e=t>0,i=K(t)>Y;function u(o,f,v,p){Ii(p,n,r,v,o,f)}function l(o,f){return W(o)*W(f)>t}function c(o){var f,v,p,s,w;return{lineStart:function(){s=p=!1,w=1},point:function(h,E){var M=[h,E],C,x=l(h,E),R=e?x?0:d(h,E):x?d(h+(h<0?$:-$),E):0;if(!f&&(s=p=x)&&o.lineStart(),x!==p&&(C=g(f,M),(!C||Ct(f,C)||Ct(M,C))&&(M[2]=1)),x!==p)w=0,x?(o.lineStart(),C=g(M,f),o.point(C[0],C[1])):(C=g(f,M),o.point(C[0],C[1],2),o.lineEnd()),f=C;else if(i&&f&&e^x){var T;!(R&v)&&(T=g(M,f,!0))&&(w=0,e?(o.lineStart(),o.point(T[0][0],T[0][1]),o.point(T[1][0],T[1][1]),o.lineEnd()):(o.point(T[1][0],T[1][1]),o.lineEnd(),o.lineStart(),o.point(T[0][0],T[0][1],3)))}x&&(!f||!Ct(f,M))&&o.point(M[0],M[1]),f=M,p=x,v=R},lineEnd:function(){p&&o.lineEnd(),f=null},clean:function(){return w|(s&&p)<<1}}}function g(o,f,v){var p=tt(o),s=tt(f),w=[1,0,0],h=Rt(p,s),E=St(h,h),M=h[0],C=E-M*M;if(!C)return!v&&o;var x=t*E/C,R=-t*M/C,T=Rt(w,h),S=Et(w,x),P=Et(h,R);Kt(S,P);var I=T,N=St(S,I),k=St(I,I),B=N*N-k*(St(S,S)-1);if(!(B<0)){var O=qn(B),L=Et(I,(-N-O)/k);if(Kt(L,S),L=oe(L),!v)return L;var y=o[0],F=f[0],z=o[1],H=f[1],G;F<y&&(G=y,y=F,F=G);var mn=F-y,fn=K(mn-$)<Y,xn=fn||mn<Y;if(!fn&&H<z&&(G=z,z=H,H=G),xn?fn?z+H>0^L[1]<(K(L[0]-y)<Y?z:H):z<=L[1]&&L[1]<=H:mn>$^(y<=L[0]&&L[0]<=F)){var Mn=Et(I,(-N+O)/k);return Kt(Mn,S),[L,oe(Mn)]}}}function d(o,f){var v=e?n:$-n,p=0;return o<-v?p|=1:o>v&&(p|=2),f<-v?p|=4:f>v&&(p|=8),p}return hr(l,c,u,e?[0,-n]:[-$,n-$])}function Di(n,t,r,e,i,u){var l=n[0],c=n[1],g=t[0],d=t[1],o=0,f=1,v=g-l,p=d-c,s;if(s=r-l,!(!v&&s>0)){if(s/=v,v<0){if(s<o)return;s<f&&(f=s)}else if(v>0){if(s>f)return;s>o&&(o=s)}if(s=i-l,!(!v&&s<0)){if(s/=v,v<0){if(s>f)return;s>o&&(o=s)}else if(v>0){if(s<o)return;s<f&&(f=s)}if(s=e-c,!(!p&&s>0)){if(s/=p,p<0){if(s<o)return;s<f&&(f=s)}else if(p>0){if(s>f)return;s>o&&(o=s)}if(s=u-c,!(!p&&s<0)){if(s/=p,p<0){if(s>f)return;s>o&&(o=s)}else if(p>0){if(s<o)return;s<f&&(f=s)}return o>0&&(n[0]=l+o*v,n[1]=c+o*p),f<1&&(t[0]=l+f*v,t[1]=c+f*p),!0}}}}}var ft=1e9,mt=-ft;function Hi(n,t,r,e){function i(d,o){return n<=d&&d<=r&&t<=o&&o<=e}function u(d,o,f,v){var p=0,s=0;if(d==null||(p=l(d,f))!==(s=l(o,f))||g(d,o)<0^f>0)do v.point(p===0||p===3?n:r,p>1?e:t);while((p=(p+f+4)%4)!==s);else v.point(o[0],o[1])}function l(d,o){return K(d[0]-n)<Y?o>0?0:3:K(d[0]-r)<Y?o>0?2:1:K(d[1]-t)<Y?o>0?1:0:o>0?3:2}function c(d,o){return g(d.x,o.x)}function g(d,o){var f=l(d,1),v=l(o,1);return f!==v?f-v:f===0?o[1]-d[1]:f===1?d[0]-o[0]:f===2?d[1]-o[1]:o[0]-d[0]}return function(d){var o=d,f=vr(),v,p,s,w,h,E,M,C,x,R,T,S={point:P,lineStart:B,lineEnd:O,polygonStart:N,polygonEnd:k};function P(y,F){i(y,F)&&o.point(y,F)}function I(){for(var y=0,F=0,z=p.length;F<z;++F)for(var H=p[F],G=1,mn=H.length,fn=H[0],xn,Mn,Wn=fn[0],Hn=fn[1];G<mn;++G)xn=Wn,Mn=Hn,fn=H[G],Wn=fn[0],Hn=fn[1],Mn<=e?Hn>e&&(Wn-xn)*(e-Mn)>(Hn-Mn)*(n-xn)&&++y:Hn<=e&&(Wn-xn)*(e-Mn)<(Hn-Mn)*(n-xn)&&--y;return y}function N(){o=f,v=[],p=[],T=!0}function k(){var y=I(),F=T&&y,z=(v=cr(v)).length;(F||z)&&(d.polygonStart(),F&&(d.lineStart(),u(null,null,1,d),d.lineEnd()),z&&pr(v,c,y,u,d),d.polygonEnd()),o=d,v=p=s=null}function B(){S.point=L,p&&p.push(s=[]),R=!0,x=!1,M=C=NaN}function O(){v&&(L(w,h),E&&x&&f.rejoin(),v.push(f.result())),S.point=P,x&&o.lineEnd()}function L(y,F){var z=i(y,F);if(p&&s.push([y,F]),R)w=y,h=F,E=z,R=!1,z&&(o.lineStart(),o.point(y,F));else if(z&&x)o.point(y,F);else{var H=[M=Math.max(mt,Math.min(ft,M)),C=Math.max(mt,Math.min(ft,C))],G=[y=Math.max(mt,Math.min(ft,y)),F=Math.max(mt,Math.min(ft,F))];Di(H,G,n,t,r,e)?(x||(o.lineStart(),o.point(H[0],H[1])),o.point(G[0],G[1]),z||o.lineEnd(),T=!1):z&&(o.lineStart(),o.point(y,F),T=!1)}M=y,C=F,x=z}return S}}const fe=n=>n;var Jt=new Zn,ce=new Zn,dr,gr,se,ve,Un={point:En,lineStart:En,lineEnd:En,polygonStart:function(){Un.lineStart=Oi,Un.lineEnd=qi},polygonEnd:function(){Un.lineStart=Un.lineEnd=Un.point=En,Jt.add(K(ce)),ce=new Zn},result:function(){var n=Jt/2;return Jt=new Zn,n}};function Oi(){Un.point=Yi}function Yi(n,t){Un.point=_r,dr=se=n,gr=ve=t}function _r(n,t){ce.add(ve*n-se*t),se=n,ve=t}function qi(){_r(dr,gr)}var et=1/0,Tt=et,dt=-et,kt=dt,Nt={point:Bi,lineStart:En,lineEnd:En,polygonStart:En,polygonEnd:En,result:function(){var n=[[et,Tt],[dt,kt]];return dt=kt=-(Tt=et=1/0),n}};function Bi(n,t){n<et&&(et=n),n>dt&&(dt=n),t<Tt&&(Tt=t),t>kt&&(kt=t)}var pe=0,he=0,ct=0,It=0,Ft=0,jn=0,de=0,ge=0,st=0,yr,Sr,An,Ln,Sn={point:Gn,lineStart:Ze,lineEnd:Ge,polygonStart:function(){Sn.lineStart=Zi,Sn.lineEnd=Gi},polygonEnd:function(){Sn.point=Gn,Sn.lineStart=Ze,Sn.lineEnd=Ge},result:function(){var n=st?[de/st,ge/st]:jn?[It/jn,Ft/jn]:ct?[pe/ct,he/ct]:[NaN,NaN];return pe=he=ct=It=Ft=jn=de=ge=st=0,n}};function Gn(n,t){pe+=n,he+=t,++ct}function Ze(){Sn.point=Xi}function Xi(n,t){Sn.point=Vi,Gn(An=n,Ln=t)}function Vi(n,t){var r=n-An,e=t-Ln,i=qn(r*r+e*e);It+=i*(An+n)/2,Ft+=i*(Ln+t)/2,jn+=i,Gn(An=n,Ln=t)}function Ge(){Sn.point=Gn}function Zi(){Sn.point=Wi}function Gi(){Er(yr,Sr)}function Wi(n,t){Sn.point=Er,Gn(yr=An=n,Sr=Ln=t)}function Er(n,t){var r=n-An,e=t-Ln,i=qn(r*r+e*e);It+=i*(An+n)/2,Ft+=i*(Ln+t)/2,jn+=i,i=Ln*n-An*t,de+=i*(An+n),ge+=i*(Ln+t),st+=i*3,Gn(An=n,Ln=t)}function wr(n){this._context=n}wr.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,wn);break}}},result:En};var _e=new Zn,jt,mr,xr,vt,pt,gt={point:En,lineStart:function(){gt.point=Ki},lineEnd:function(){jt&&Mr(mr,xr),gt.point=En},polygonStart:function(){jt=!0},polygonEnd:function(){jt=null},result:function(){var n=+_e;return _e=new Zn,n}};function Ki(n,t){gt.point=Mr,mr=vt=n,xr=pt=t}function Mr(n,t){vt-=n,pt-=t,_e.add(qn(vt*vt+pt*pt)),vt=n,pt=t}let We,zt,Ke,Qe;class Je{constructor(t){this._append=t==null?Cr:Qi(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==Ke||this._append!==zt){const e=this._radius,i=this._;this._="",this._append`m0,${e}a${e},${e} 0 1,1 0,${-2*e}a${e},${e} 0 1,1 0,${2*e}z`,Ke=e,zt=this._append,Qe=this._,this._=i}this._+=Qe;break}}}result(){const t=this._;return this._="",t.length?t:null}}function Cr(n){let t=1;this._+=n[0];for(const r=n.length;t<r;++t)this._+=arguments[t]+n[t]}function Qi(n){const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);if(t>15)return Cr;if(t!==We){const r=10**t;We=t,zt=function(i){let u=1;this._+=i[0];for(const l=i.length;u<l;++u)this._+=Math.round(arguments[u]*r)/r+i[u]}}return zt}function ne(n,t){let r=3,e=4.5,i,u;function l(c){return c&&(typeof e=="function"&&u.pointRadius(+e.apply(this,arguments)),Qn(c,i(u))),u.result()}return l.area=function(c){return Qn(c,i(Un)),Un.result()},l.measure=function(c){return Qn(c,i(gt)),gt.result()},l.bounds=function(c){return Qn(c,i(Nt)),Nt.result()},l.centroid=function(c){return Qn(c,i(Sn)),Sn.result()},l.projection=function(c){return arguments.length?(i=c==null?(n=null,fe):(n=c).stream,l):n},l.context=function(c){return arguments.length?(u=c==null?(t=null,new Je(r)):new wr(t=c),typeof e!="function"&&u.pointRadius(e),l):t},l.pointRadius=function(c){return arguments.length?(e=typeof c=="function"?c:(u.pointRadius(+c),+c),l):e},l.digits=function(c){if(!arguments.length)return r;if(c==null)r=null;else{const g=Math.floor(c);if(!(g>=0))throw new RangeError(`invalid digits: ${c}`);r=g}return t===null&&(u=new Je(r)),l},l.projection(n).digits(r).context(t)}function me(n){return function(t){var r=new ye;for(var e in n)r[e]=n[e];return r.stream=t,r}}function ye(){}ye.prototype={constructor:ye,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function xe(n,t,r){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),Qn(r,n.stream(Nt)),t(Nt.result()),e!=null&&n.clipExtent(e),n}function Pr(n,t,r){return xe(n,function(e){var i=t[1][0]-t[0][0],u=t[1][1]-t[0][1],l=Math.min(i/(e[1][0]-e[0][0]),u/(e[1][1]-e[0][1])),c=+t[0][0]+(i-l*(e[1][0]+e[0][0]))/2,g=+t[0][1]+(u-l*(e[1][1]+e[0][1]))/2;n.scale(150*l).translate([c,g])},r)}function Ji(n,t,r){return Pr(n,[[0,0],t],r)}function ji(n,t,r){return xe(n,function(e){var i=+t,u=i/(e[1][0]-e[0][0]),l=(i-u*(e[1][0]+e[0][0]))/2,c=-u*e[0][1];n.scale(150*u).translate([l,c])},r)}function no(n,t,r){return xe(n,function(e){var i=+t,u=i/(e[1][1]-e[0][1]),l=-u*e[0][0],c=(i-u*(e[1][1]+e[0][1]))/2;n.scale(150*u).translate([l,c])},r)}var je=16,to=W(30*sn);function nr(n,t){return+t?ro(n,t):eo(n)}function eo(n){return me({point:function(t,r){t=n(t,r),this.stream.point(t[0],t[1])}})}function ro(n,t){function r(e,i,u,l,c,g,d,o,f,v,p,s,w,h){var E=d-e,M=o-i,C=E*E+M*M;if(C>4*t&&w--){var x=l+v,R=c+p,T=g+s,S=qn(x*x+R*R+T*T),P=ht(T/=S),I=K(K(T)-1)<Y||K(u-f)<Y?(u+f)/2:nt(R,x),N=n(I,P),k=N[0],B=N[1],O=k-e,L=B-i,y=M*O-E*L;(y*y/C>t||K((E*O+M*L)/C-.5)>.3||l*v+c*p+g*s<to)&&(r(e,i,u,l,c,g,k,B,I,x/=S,R/=S,T,w,h),h.point(k,B),r(k,B,I,x,R,T,d,o,f,v,p,s,w,h))}}return function(e){var i,u,l,c,g,d,o,f,v,p,s,w,h={point:E,lineStart:M,lineEnd:x,polygonStart:function(){e.polygonStart(),h.lineStart=R},polygonEnd:function(){e.polygonEnd(),h.lineStart=M}};function E(P,I){P=n(P,I),e.point(P[0],P[1])}function M(){f=NaN,h.point=C,e.lineStart()}function C(P,I){var N=tt([P,I]),k=n(P,I);r(f,v,o,p,s,w,f=k[0],v=k[1],o=P,p=N[0],s=N[1],w=N[2],je,e),e.point(f,v)}function x(){h.point=E,e.lineEnd()}function R(){M(),h.point=T,h.lineEnd=S}function T(P,I){C(i=P,I),u=f,l=v,c=p,g=s,d=w,h.point=C}function S(){r(f,v,o,p,s,w,u,l,i,c,g,d,je,e),h.lineEnd=x,x()}return h}}var io=me({point:function(n,t){this.stream.point(n*sn,t*sn)}});function oo(n){return me({point:function(t,r){var e=n(t,r);return this.stream.point(e[0],e[1])}})}function ao(n,t,r,e,i){function u(l,c){return l*=e,c*=i,[t+n*l,r-n*c]}return u.invert=function(l,c){return[(l-t)/n*e,(r-c)/n*i]},u}function tr(n,t,r,e,i,u){if(!u)return ao(n,t,r,e,i);var l=W(u),c=Q(u),g=l*n,d=c*n,o=l/n,f=c/n,v=(c*r-l*t)/n,p=(c*t+l*r)/n;function s(w,h){return w*=e,h*=i,[g*w-d*h+t,r-d*w-g*h]}return s.invert=function(w,h){return[e*(o*w-f*h+v),i*(p-f*w-o*h)]},s}function lo(n){var t,r=150,e=480,i=250,u=0,l=0,c=0,g=0,d=0,o,f=0,v=1,p=1,s=null,w=Ve,h=null,E,M,C,x=fe,R=.5,T,S,P,I,N;function k(y){return P(y[0]*sn,y[1]*sn)}function B(y){return y=P.invert(y[0],y[1]),y&&[y[0]*Rn,y[1]*Rn]}k.stream=function(y){return I&&N===y?I:I=io(oo(o)(w(T(x(N=y)))))},k.preclip=function(y){return arguments.length?(w=y,s=void 0,L()):w},k.postclip=function(y){return arguments.length?(x=y,h=E=M=C=null,L()):x},k.clipAngle=function(y){return arguments.length?(w=+y?Ui(s=y*sn):(s=null,Ve),L()):s*Rn},k.clipExtent=function(y){return arguments.length?(x=y==null?(h=E=M=C=null,fe):Hi(h=+y[0][0],E=+y[0][1],M=+y[1][0],C=+y[1][1]),L()):h==null?null:[[h,E],[M,C]]},k.scale=function(y){return arguments.length?(r=+y,O()):r},k.translate=function(y){return arguments.length?(e=+y[0],i=+y[1],O()):[e,i]},k.center=function(y){return arguments.length?(u=y[0]%360*sn,l=y[1]%360*sn,O()):[u*Rn,l*Rn]},k.rotate=function(y){return arguments.length?(c=y[0]%360*sn,g=y[1]%360*sn,d=y.length>2?y[2]%360*sn:0,O()):[c*Rn,g*Rn,d*Rn]},k.angle=function(y){return arguments.length?(f=y%360*sn,O()):f*Rn},k.reflectX=function(y){return arguments.length?(v=y?-1:1,O()):v<0},k.reflectY=function(y){return arguments.length?(p=y?-1:1,O()):p<0},k.precision=function(y){return arguments.length?(T=nr(S,R=y*y),L()):qn(R)},k.fitExtent=function(y,F){return Pr(k,y,F)},k.fitSize=function(y,F){return Ji(k,y,F)},k.fitWidth=function(y,F){return ji(k,y,F)},k.fitHeight=function(y,F){return no(k,y,F)};function O(){var y=tr(r,0,0,v,p,f).apply(null,t(u,l)),F=tr(r,e-y[0],i-y[1],v,p,f);return o=Ni(c,g,d),S=le(t,F),P=le(o,S),T=nr(S,R),L()}function L(){return I=N=null,k}return function(){return t=n.apply(this,arguments),k.invert=t.invert&&B,O()}}function uo(n){var t=0,r=$/3,e=lo(n),i=e(t,r);return i.parallels=function(u){return arguments.length?e(t=u[0]*sn,r=u[1]*sn):[t*Rn,r*Rn]},i}function Rr(n,t){return[n,re(sr((rn+t)/2))]}Rr.invert=function(n,t){return[n,2*we(Ti(t))-rn]};function xt(n){return sr((rn+n)/2)}function fo(n,t){var r=W(n),e=n===t?Q(n):re(r/W(t))/re(xt(t)/xt(n)),i=r*Wt(xt(n),e)/e;if(!e)return Rr;function u(l,c){i>0?c<-rn+Y&&(c=-rn+Y):c>rn-Y&&(c=rn-Y);var g=i/Wt(xt(c),e);return[g*Q(e*l),i-g*W(e*l)]}return u.invert=function(l,c){var g=i-c,d=ut(e)*qn(l*l+g*g),o=nt(l,K(g))*ut(g);return g*e<0&&(o-=$*ut(l)*ut(g)),[o/e,2*we(Wt(i/d,1/e))-rn]},u}function co(){return uo(fo).scale(109.5).parallels([30,30])}var so=Se('<path fill="#f5f5f5" stroke="#d4d4d8" stroke-width="1.5" vector-effect="non-scaling-stroke"></path>'),vo=Se('<line stroke="#000" stroke-opacity="0.2" stroke-width="1" vector-effect="non-scaling-stroke"></line>'),po=Se('<g class="transition-opacity duration-200"><g data-label-hit="" class="cursor-pointer" role="button" tabindex="0"><!><rect fill="black" stroke="black" stroke-width="0" vector-effect="non-scaling-stroke"></rect><text text-anchor="middle" dominant-baseline="middle" font-weight="400" fill="white" class="pointer-events-none select-none" vector-effect="non-scaling-stroke"> </text><title> </title></g></g>'),ho=Nn('<section class="bg-[#ccc]"><div class="absolute top-4 right-4 flex z-50 space-x-2"><button class="bg-white px-2 py-1 font-bold text-black border">−</button> <button class="bg-white px-2 py-1 font-bold text-black border">+</button></div> <svg class="block h-full w-full cursor-grab touch-none select-none overflow-visible active:cursor-grabbing" preserveAspectRatio="xMidYMid meet" role="application" aria-label="Fanzine map (pan and zoom)"><g><!><!></g></svg></section>');function go(n,t){Lt(t,!1);let r=en(t,"italy",8,null),e=en(t,"points",24,()=>[]);en(t,"filteredItems",24,()=>[]);let i=en(t,"query",8,""),u=en(t,"projectionZoom",8,1.25),l=en(t,"onSelect",8,null);const c=er(),g=1,d=1,o=2,f=6,v=100,p=new Map,s=1500,w=1800,h='"Courier New", Courier, monospace';let E=on(null),M=on(""),C=on(null),x=on([]),R=on([]),T=[];const S=0,P=0;let I=on(1),N=on(S),k=on(P),B=!1,O={x:0,y:0,translateX:0,translateY:0},L=!1,y=on(!1);const F=typeof document<"u"?document.createElement("canvas"):null,z=F?F.getContext("2d"):null;function H(m){const _=m.currentTarget?.ownerSVGElement||m.currentTarget;if(!_?.createSVGPoint)return{x:0,y:0};const A=_.createSVGPoint();A.x=m.clientX,A.y=m.clientY;const q=_.getScreenCTM?.();if(!q)return{x:0,y:0};const J=q.inverse(),an=A.matrixTransform(J);return{x:an.x,y:an.y}}function G(m){const _=m.composedPath?.();return _?_.some(A=>A?.dataset&&"labelHit"in A.dataset):!!m.target?.closest?.("[data-label-hit]")}function mn(m,_=s/2,A=w/2){const q=m>0?1.1:.9090909090909091,J=Math.max(.5,Math.min(8,a(I)*q));J!==a(I)&&(Z(N,_-(_-a(N))/a(I)*J),Z(k,A-(A-a(k))/a(I)*J),Z(I,J))}function fn(){if(!a(E)||!e()||e().length===0){T=[];return}const m=100;T=e().filter(_=>{const A=parseFloat(_.latitude),q=parseFloat(_.longitude);if(!isFinite(A)||!isFinite(q))return!1;const[J,an]=a(E)([q,A]),V=a(N)+J*a(I),nn=a(k)+an*a(I);return V>-m&&V<s+m&&nn>-m&&nn<w+m}),c("visibleItemsChange",T)}function xn(m){m.preventDefault();const _=m.deltaY>0?-1:1,A=H(m);mn(_,A.x,A.y)}function Mn(m){if(m.button!=null&&m.button!==0||G(m))return;B=!0,L=!1;const _=H(m);O={x:_.x,y:_.y,translateX:a(N),translateY:a(k)}}function Wn(m){if(!B)return;const _=H(m),A=_.x-O.x,q=_.y-O.y;!L&&Math.hypot(A,q)>3&&(L=!0,G(m)&&Z(y,!0),m.currentTarget.setPointerCapture?.(m.pointerId)),L&&(Z(N,O.translateX+A),Z(k,O.translateY+q))}function Hn(m){B&&(B=!1,m.currentTarget.releasePointerCapture?.(m.pointerId),L&&(Z(y,!0),setTimeout(()=>Z(y,!1),100)))}function Tr(m){B=!1,m.currentTarget.releasePointerCapture?.(m.pointerId)}function Me(m,_){if(!z)return m.length*_*.6;const A=`${m}:${_}`;if(p.has(A))return p.get(A);z.font=`700 ${_}px ${h}`;const q=z.measureText(m).width;return p.set(A,q),q}function kr(m,_){if(!m||!isFinite(_)||_===1)return;const A=s/2,q=w/2,[J,an]=m.translate();m.scale(m.scale()*_),m.translate([A+(J-A)*_,q+(an-q)*_])}function Nr(m){const _=new Map;function A(V,nn){return`${V},${nn}`}function q(V){const nn=Math.floor(V.left/m),Cn=Math.floor(V.right/m),In=Math.floor(V.top/m),Fn=Math.floor(V.bottom/m);return{x0:nn,x1:Cn,y0:In,y1:Fn}}function J(V,nn){const{x0:Cn,x1:In,y0:Fn,y1:vn}=q(nn);for(let ln=Fn;ln<=vn;ln++)for(let $n=Cn;$n<=In;$n++){const Bn=A($n,ln);let X=_.get(Bn);X||(X=new Set,_.set(Bn,X)),X.add(V)}}function an(V){const{x0:nn,x1:Cn,y0:In,y1:Fn}=q(V),vn=new Set;for(let ln=In;ln<=Fn;ln++)for(let $n=nn;$n<=Cn;$n++){const Bn=_.get(A($n,ln));if(Bn)for(const X of Bn)vn.add(X)}return vn}return{insert:J,candidates:an}}function Ir(m,_){return!(m.right<=_.left||m.left>=_.right||m.bottom<=_.top||m.top>=_.bottom)}function Ce(m,_,A,q,J){const an=A/2,V=q/2;return{x:Math.max(J.left+an,Math.min(J.right-an,m)),y:Math.max(J.top+V,Math.min(J.bottom-V,_))}}function Fr(m,_,A,q,J){if(!_||!m.length)return[];const an=Math.max(o,Math.min(f,Math.floor(A/140))),V=Math.min(v,Math.floor(A*.18)),nn=J||{left:16,top:16,right:A-16,bottom:q-16},Cn=m.map(X=>{const un=_([X.lon,X.lat]);if(!un)return null;const[Pn,gn]=un,cn=(X.fanzine||"N/A").toUpperCase();return{...X,x0:Pn,y0:gn,text:cn}}).filter(Boolean);if(!Cn.length)return[];Cn.sort((X,un)=>X.y0-un.y0||X.x0-un.x0);const In=Math.max(24,Math.ceil(an+d*3)),Fn=Nr(In),vn=[],ln=[];function $n(X,un,Pn,gn){const{x:cn,y:zn}=Ce(Pn,gn,X,un,nn),_n={left:cn-X/2-d,right:cn+X/2+d,top:zn-un/2-d,bottom:zn+un/2+d},dn=Fn.candidates(_n);for(const rt of dn)if(Ir(_n,vn[rt]))return null;const Xn=vn.length;return vn.push(_n),Fn.insert(Xn,_n),{x:cn,y:zn}}function*Bn(X,un,Pn,gn){yield{x:X,y:un};for(let cn=Pn;cn<=gn;cn+=Pn){const zn=Math.max(8,Math.ceil(2*Math.PI*cn/Pn));for(let _n=0;_n<zn;_n++){const dn=_n/zn*Math.PI*2;yield{x:X+Math.cos(dn)*cn,y:un+Math.sin(dn)*cn}}}}for(const X of Cn){const un=X.x0,Pn=X.y0;let gn=null,cn=an,zn=0,_n=0;for(let dn=an;dn>=o;dn--){const Xn=Math.ceil(Me(X.text,dn)+g*2),rt=Math.ceil(dn+g*2),br=Math.max(10,Math.ceil(rt+d));for(const _t of Bn(un,Pn,br,V)){const Te=_t.x-un,ke=_t.y-Pn;if(Te*Te+ke*ke>V*V)continue;const Ne=$n(Xn,rt,_t.x,_t.y);if(Ne){gn=Ne,cn=dn,zn=Xn,_n=rt;break}}if(gn)break}if(!gn){const dn=Math.ceil(Me(X.text,o)+g*2),Xn=Math.ceil(o+g*2);gn=Ce(un,Pn,dn,Xn,nn),cn=o,zn=dn,_n=Xn}ln.push({...X,x:gn.x,y:gn.y,fontSize:cn,width:zn,height:_n})}return ln}function zr(m,_){(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),c("select",_))}Jn(()=>(at(r()),at(u()),ne),()=>{if(r()){const m=co().parallels([37,45]);m.fitExtent([[0,0],[s,w]],r()),kr(m,u()),Z(E,m),Z(M,ne(m)(r())||"");const _=ne(m).bounds(r());Z(C,_?{left:_[0][0],top:_[0][1],right:_[1][0],bottom:_[1][1]}:null)}}),Jn(()=>(a(E),at(e()),a(C)),()=>{if(a(E)&&e()?.length){const _=a(C)?{left:a(C).left-500,top:a(C).top-500,right:a(C).right+500,bottom:a(C).bottom+500}:null;Z(x,Fr(e(),a(E),s,w,_))}}),Jn(()=>(at(i()),a(x)),()=>{if(!i())Z(R,a(x));else{const m=i().toLowerCase();Z(R,a(x).filter(_=>_.fanzine?.toLowerCase().includes(m)||_.city?.toLowerCase().includes(m)||_.genre?.toLowerCase().includes(m)))}}),Jn(()=>(a(I),a(N),a(k)),()=>{a(I),a(N),a(k),fn()}),ar(),At();var bt=ho(),Ut=D(bt),Pe=D(Ut),Ar=j(Pe,2);U(Ut);var On=j(Ut,2);tn(On,"viewBox",`0 0 ${s} ${w}`);var Dt=D(On),Re=D(Dt);{var Lr=m=>{var _=so();Tn(()=>tn(_,"d",a(M))),hn(m,_)};Vn(Re,m=>{a(M)&&m(Lr)})}var $r=j(Re);lr($r,1,()=>a(R),fi,(m,_)=>{var A=po(),q=D(A),J=D(q);{var an=vn=>{var ln=vo();Tn(()=>{tn(ln,"x1",(a(_),b(()=>a(_).x0))),tn(ln,"y1",(a(_),b(()=>a(_).y0))),tn(ln,"x2",(a(_),b(()=>a(_).x))),tn(ln,"y2",(a(_),b(()=>a(_).y)))}),hn(vn,ln)};Vn(J,vn=>{a(_),b(()=>Math.hypot(a(_).x-a(_).x0,a(_).y-a(_).y0)>6)&&vn(an)})}var V=j(J),nn=j(V),Cn=D(nn,!0);U(nn);var In=j(nn),Fn=D(In);U(In),U(q),U(A),Tn(()=>{tn(V,"x",(a(_),b(()=>a(_).x-a(_).width/2))),tn(V,"y",(a(_),b(()=>a(_).y-a(_).height/2))),tn(V,"width",(a(_),b(()=>a(_).width))),tn(V,"height",(a(_),b(()=>a(_).height))),tn(nn,"x",(a(_),b(()=>a(_).x))),tn(nn,"y",(a(_),b(()=>a(_).y))),tn(nn,"font-size",(a(_),b(()=>a(_).fontSize))),kn(Cn,(a(_),b(()=>a(_).text))),kn(Fn,`${a(_),b(()=>a(_).fanzine)??""} (${a(_),b(()=>a(_).city)??""})`)}),yn("pointerup",q,yi(()=>{console.log("mapLabelPointerUp",{fanzine:a(_)?.fanzine,city:a(_)?.city,canonicalUrl:a(_)?.canonicalUrl}),a(y)||(l()?.(a(_)),c("select",a(_)))})),yn("click",q,()=>{console.log("mapLabelClick",{fanzine:a(_)?.fanzine,city:a(_)?.city,canonicalUrl:a(_)?.canonicalUrl}),a(y)||(l()?.(a(_)),c("select",a(_)))}),yn("keydown",q,vn=>zr(vn,a(_))),hn(m,A)}),U(Dt),U(On),U(bt),Tn(()=>tn(Dt,"transform",`translate(${a(N)} ${a(k)}) scale(${a(I)})`)),yn("click",Pe,()=>mn(-1)),yn("click",Ar,()=>mn(1)),yn("wheel",On,xn),yn("pointerdown",On,Mn),yn("pointermove",On,Wn),yn("pointerup",On,Hn),yn("pointercancel",On,Tr),hn(n,bt),$t()}var _o=Nn('<button type="button" class=" border border-black px-2 py-1 text-sm text-black">X</button>'),yo=Nn('<div class="grid w-full max-w-[520px]"><div class="flex items-center gap-2"><input type="text" placeholder="Search..." class="flex-1 border border-black bg-white px-2 py-1 text-sm text-black outline-none" aria-label="Search fanzines"/> <!></div></div>');function So(n,t){Lt(t,!1);let r=en(t,"query",12,"");en(t,"totalCount",8,0),en(t,"visibleCount",8,0),en(t,"resultsCount",8,0);let e=en(t,"hasSelection",8,!1);const i=er();function u(){r(""),i("clear")}At();var l=yo(),c=D(l),g=D(c);ui(g);var d=j(g,2);{var o=f=>{var v=_o();yn("click",v,u),hn(f,v)};Vn(d,f=>{(r()||e())&&f(o)})}U(c),U(l),_i(g,r),hn(n,l),$t()}var Eo=Nn('<img class="h-full w-full object-contain" loading="lazy"/>'),wo=Nn('<div class="mt-2 text-xs leading-snug text-black/60"><div> </div> <button type="button" class="mt-1 text-xs font-medium text-blue-600 hover:text-blue-800"> </button></div>'),mo=Nn('<a class=" bg-black/5 px-2 py-1 hover:bg-black/10" target="_blank" rel="noreferrer">PDF</a>'),xo=Nn('<a class=" bg-black/5 px-2 py-1 text-black hover:bg-black/10" target="_blank" rel="noreferrer">Page</a>'),Mo=Nn('<div role="listitem" class=" bg-white p-1 text-left shadow-sm"><div class="aspect-[3/4] w-full overflow-hidden  bg-black/5"><!></div> <div class="mt-1 truncate font-bold leading-tight"> </div> <div class="truncate leading-tight"> </div> <div class="mt-0.5 line-clamp-2 leading-tight"> </div> <!> <div class="mt-2 gap-2 "><!> <!></div></div>'),Co=Nn('<div class="py-2"><div class="text-xs leading-tight text-black/70"><strong class="text-black"> </strong> fanzine</div> <div class="grid grid-cols-2 md:grid-cols-6  gap-3 p-2" role="list" aria-label="Fanzines"></div></div>');function Po(n,t){Lt(t,!1);let r=en(t,"items",24,()=>[]);const e="https://www.paolopalmacci.it/capitmundi/";let i=on(null);function u(p){return p?/^https?:\/\//i.test(p)?p:`${e}${String(p).replace(/^\/+/,"")}`:""}function l(p){return p?.yearStart?p?.yearEnd&&p.yearEnd!==p.yearStart?`${p.yearStart}-${p.yearEnd}`:String(p.yearStart):""}function c(p,s){const w=[p?.sourceFile,p?.canonicalUrl,p?.pdfHref,p?.title,p?.fanzine,p?.city,p?.yearStart,p?.yearEnd].filter(h=>h!=null&&String(h).trim()!=="").map(h=>String(h));return w.length?`${w.join("|")}|${s}`:String(s)}At();var g=Co(),d=D(g),o=D(d),f=D(o,!0);U(o),li(),U(d);var v=j(d,2);lr(v,7,r,(p,s)=>c(p,s),(p,s,w)=>{var h=Mo(),E=D(h),M=D(E);{var C=z=>{var H=Eo();Tn(G=>{tn(H,"src",G),tn(H,"alt",(a(s),b(()=>a(s).fanzine||"Fanzine cover")))},[()=>(a(s),b(()=>u(a(s).ogImage)))]),hn(z,H)};Vn(M,z=>{a(s),b(()=>a(s).ogImage)&&z(C)})}U(E);var x=j(E,2),R=D(x,!0);U(x);var T=j(x,2),S=D(T);U(T);var P=j(T,2),I=D(P);U(P);var N=j(P,2);{var k=z=>{var H=wo(),G=D(H),mn=D(G,!0);U(G);var fn=j(G,2),xn=D(fn,!0);U(fn),U(H),Tn(()=>{gi(G,1,hi(a(i)===a(w)?"":"line-clamp-3")),kn(mn,(a(s),b(()=>a(s).description))),kn(xn,a(i)===a(w)?"Read less":"Read more")}),yn("click",fn,()=>{Z(i,a(i)===a(w)?null:a(w))}),hn(z,H)};Vn(N,z=>{a(s),b(()=>a(s).description)&&z(k)})}var B=j(N,2),O=D(B);{var L=z=>{var H=mo();Tn(G=>tn(H,"href",G),[()=>(a(s),b(()=>u(a(s).pdfHref)))]),hn(z,H)};Vn(O,z=>{a(s),b(()=>a(s)?.pdfHref)&&z(L)})}var y=j(O,2);{var F=z=>{var H=xo();Tn(()=>tn(H,"href",(a(s),b(()=>a(s).canonicalUrl)))),hn(z,H)};Vn(y,z=>{a(s),b(()=>a(s)?.canonicalUrl)&&z(F)})}U(B),U(h),Tn(z=>{kn(R,(a(s),b(()=>a(s).fanzine))),kn(S,`${a(s),b(()=>a(s).city)??""}${a(s),b(()=>a(s).country?`, ${a(s).country}`:"")??""}`),kn(I,`${a(s),b(()=>a(s).genre||"—")??""}${z??""}`)},[()=>(a(s),b(()=>l(a(s))?` · ${l(a(s))}`:""))]),hn(p,h)}),U(v),U(g),Tn(()=>kn(f,(at(r()),b(()=>r().length)))),hn(n,g),$t()}var Ro=Nn('<div class="bg-white"><!> <div class="sticky top-0 z-0 h-[60vh] w-full"><div class="h-full w-full overflow-hidden bg-white"><!></div></div> <div class="relative mx-auto bg-white w-full px-2 py-4"><!> <!></div></div>');function Lo(n,t){Lt(t,!1);const r=on(),e=on();function i(S){return{sourceFile:S.source_file,canonicalUrl:S.canonical_url,title:S.title,fanzine:S.fanzine||"N/A",city:S.city||"Unknown",country:S.country,activity:S.activity,yearStart:S.year_start,yearEnd:S.year_end,genre:S.genre,description:S.description,pdfHref:S.pdf_href,ogImage:S.og_image,latitude:S.latitude,longitude:S.longitude}}let u=on(null),l=on([]),c=on([]),g=!0,d=on(""),o=on(null),f=on([]);function v(){Z(d,""),Z(o,null)}function p(S){Z(o,S.detail)}function s(S){Z(f,S.detail)}Ur(async()=>{try{g=!0;const S=await fetch("/data/italy2.geojson");if(!S.ok)throw new Error("Failed to load geojson");Z(u,await S.json());const P=await fetch("/fanzines.csv");if(!P.ok)throw new Error("Failed to load fanzines.csv");const I=await P.text();Z(l,Mi(I).map(i)),Z(c,a(l).map(N=>{const k=parseFloat(N.latitude),B=parseFloat(N.longitude);return!isFinite(k)||!isFinite(B)?null:{...N,lat:k,lon:B}}).filter(Boolean))}catch(S){S instanceof Error?S.message:String(S)}finally{g=!1}}),Jn(()=>(a(d),a(l)),()=>{Z(r,a(d)?a(l).filter(S=>{const P=a(d).toLowerCase();return S.fanzine?.toLowerCase().includes(P)||S.city?.toLowerCase().includes(P)||S.genre?.toLowerCase().includes(P)}):[])}),Jn(()=>(a(d),a(c)),()=>{Z(e,a(d)?a(c).filter(S=>{const P=a(d).toLowerCase();return S.fanzine?.toLowerCase().includes(P)||S.city?.toLowerCase().includes(P)||S.genre?.toLowerCase().includes(P)}).length:a(c).length)}),ar(),At();var w=Ro(),h=D(w);Pi(h,{});var E=j(h,2),M=D(E),C=D(M);{let S=Mt(()=>a(o)?[a(o)]:a(d)?a(r):a(l));go(C,{get italy(){return a(u)},get points(){return a(c)},get query(){return a(d)},projectionZoom:1,get filteredItems(){return a(S)},$$events:{select:p,visibleItemsChange:s}})}U(M),U(E);var x=j(E,2),R=D(x);{let S=Mt(()=>!!a(o));So(R,{get totalCount(){return a(l),b(()=>a(l).length)},get visibleCount(){return a(e)},get resultsCount(){return a(r),b(()=>a(r).length)},get hasSelection(){return a(S)},get query(){return a(d)},set query(P){Z(d,P)},$$events:{clear:v},$$legacy:!0})}var T=j(R,2);{let S=Mt(()=>(a(o),a(d),a(r),a(f),a(l),b(()=>a(o)?[a(o)]:a(d)?a(r):a(f).length>0?a(f):a(l))));Po(T,{get items(){return a(S)}})}U(x),U(w),hn(n,w),$t()}export{Lo as component};
