import{a as on,f as pn,d as oe}from"../chunks/CsXbaW0u.js";import{i as yt}from"../chunks/CujRvGow.js";import{c as De,o as Sr}from"../chunks/BY5szE3h.js";import{e as Pt,H as Er,aS as Ue,h as xn,P as Rt,a4 as wr,I as mr,t as a,K as xr,M as Cr,O as de,Q as Tt,i as et,af as Mr,aJ as Pr,ar as pe,c as Ln,aT as Mn,f as Ot,s as Rr,$ as ut,y as Tr,aH as ae,aU as Ir,aV as kr,aO as W,ae as he,aW as Nr,r as He,p as Oe,aX as It,q as Ar,aY as br,aZ as Fr,aG as zr,d as Lr,aD as $r,a_ as Dr,aP as Ur,l as H,ac as Hr,a$ as Or,C as sn,E as q,F as O,G as nn,A as St,b0 as Nn,b1 as Ye,D as Et,v as kn,V as L,as as Yr,B as qr}from"../chunks/Bz0-R9yI.js";import{s as _n,e as fn}from"../chunks/BPKptqdW.js";import{p as K,i as An}from"../chunks/CgWTwZ29.js";import{s as J,r as Vr}from"../chunks/CF3Zwip9.js";function Xr(n,t){return t}function Zr(n,t,r){for(var e=[],i=t.length,f,l=t.length,s=0;s<i;s++){let u=t[s];Oe(u,()=>{if(f){if(f.pending.delete(u),f.done.add(u),f.pending.size===0){var c=n.outrogroups;Yt(ae(f.done)),c.delete(f),c.size===0&&(n.outrogroups=null)}}else l-=1},!1)}if(l===0){var h=e.length===0&&r!==null;if(h){var g=r,o=g.parentNode;zr(o),o.append(g),n.items.clear()}Yt(t,!h)}else f={pending:new Set(t),done:new Set},(n.outrogroups??=new Set).add(f)}function Yt(n,t=!0){for(var r=0;r<n.length;r++)Lr(n[r],t)}var ge;function qe(n,t,r,e,i,f=null){var l=n,s=new Map,h=(t&Ue)!==0;if(h){var g=n;l=xn?Rt(wr(g)):g.appendChild(Pt())}xn&&mr();var o=null,u=ut(()=>{var E=r();return Tr(E)?E:E==null?[]:ae(E)}),c,d=!0;function v(){p.fallback=o,Br(p,c,l,t,e),o!==null&&(c.length===0?(o.f&Mn)===0?He(o):(o.f^=Mn,Zn(o,null,l)):Oe(o,()=>{o=null}))}var w=Er(()=>{c=a(u);var E=c.length;let C=!1;if(xn){var T=xr(l)===Cr;T!==(E===0)&&(l=de(),Rt(l),Tt(!1),C=!0)}for(var m=new Set,x=Ln,M=Rr(),I=0;I<E;I+=1){xn&&et.nodeType===Mr&&et.data===Pr&&(l=et,C=!0,Tt(!1));var k=c[I],y=e(k,I),R=d?null:s.get(y);R?(R.v&&pe(R.v,k),R.i&&pe(R.i,I),M&&x.skipped_effects.delete(R.e)):(R=Gr(s,d?l:ge??=Pt(),k,y,I,i,t,r),d||(R.e.f|=Mn),s.set(y,R)),m.add(y)}if(E===0&&f&&!o&&(d?o=Ot(()=>f(l)):(o=Ot(()=>f(ge??=Pt())),o.f|=Mn)),xn&&E>0&&Rt(de()),!d)if(M){for(const[N,$]of s)m.has(N)||x.skipped_effects.add($.e);x.oncommit(v),x.ondiscard(()=>{})}else v();C&&Tt(!0),a(u)}),p={effect:w,items:s,outrogroups:null,fallback:o};d=!1,xn&&(l=et)}function Vn(n){for(;n!==null&&(n.f&br)===0;)n=n.next;return n}function Br(n,t,r,e,i){var f=(e&Fr)!==0,l=t.length,s=n.items,h=Vn(n.effect.first),g,o=null,u,c=[],d=[],v,w,p,E;if(f)for(E=0;E<l;E+=1)v=t[E],w=i(v,E),p=s.get(w).e,(p.f&Mn)===0&&(p.nodes?.a?.measure(),(u??=new Set).add(p));for(E=0;E<l;E+=1){if(v=t[E],w=i(v,E),p=s.get(w).e,n.outrogroups!==null)for(const R of n.outrogroups)R.pending.delete(p),R.done.delete(p);if((p.f&Mn)!==0)if(p.f^=Mn,p===h)Zn(p,null,r);else{var C=o?o.next:h;p===n.effect.last&&(n.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),Tn(n,o,p),Tn(n,p,C),Zn(p,C,r),o=p,c=[],d=[],h=Vn(o.next);continue}if((p.f&It)!==0&&(He(p),f&&(p.nodes?.a?.unfix(),(u??=new Set).delete(p))),p!==h){if(g!==void 0&&g.has(p)){if(c.length<d.length){var T=d[0],m;o=T.prev;var x=c[0],M=c[c.length-1];for(m=0;m<c.length;m+=1)Zn(c[m],T,r);for(m=0;m<d.length;m+=1)g.delete(d[m]);Tn(n,x.prev,M.next),Tn(n,o,x),Tn(n,M,T),h=T,o=M,E-=1,c=[],d=[]}else g.delete(p),Zn(p,h,r),Tn(n,p.prev,p.next),Tn(n,p,o===null?n.effect.first:o.next),Tn(n,o,p),o=p;continue}for(c=[],d=[];h!==null&&h!==p;)(g??=new Set).add(h),d.push(h),h=Vn(h.next);if(h===null)continue}(p.f&Mn)===0&&c.push(p),o=p,h=Vn(p.next)}if(n.outrogroups!==null){for(const R of n.outrogroups)R.pending.size===0&&(Yt(ae(R.done)),n.outrogroups?.delete(R));n.outrogroups.size===0&&(n.outrogroups=null)}if(h!==null||g!==void 0){var I=[];if(g!==void 0)for(p of g)(p.f&It)===0&&I.push(p);for(;h!==null;)(h.f&It)===0&&h!==n.fallback&&I.push(h),h=Vn(h.next);var k=I.length;if(k>0){var y=(e&Ue)!==0&&l===0?r:null;if(f){for(E=0;E<k;E+=1)I[E].nodes?.a?.measure();for(E=0;E<k;E+=1)I[E].nodes?.a?.fix()}Zr(n,I,y)}}f&&Ar(()=>{if(u!==void 0)for(p of u)p.nodes?.a?.apply()})}function Gr(n,t,r,e,i,f,l,s){var h=(l&Ir)!==0?(l&kr)===0?W(r,!1,!1):he(r):null,g=(l&Nr)!==0?he(i):null;return{v:h,i:g,e:Ot(()=>(f(t,h??r,g??i,s),()=>{n.delete(e)}))}}function Zn(n,t,r){if(n.nodes)for(var e=n.nodes.start,i=n.nodes.end,f=t&&(t.f&Mn)===0?t.nodes.start:r;e!==null;){var l=$r(e);if(f.before(e),e===i)return;e=l}}function Tn(n,t,r){t===null?n.effect.first=r:t.next=r,r===null?n.effect.last=t:r.prev=t}function Ve(n){var t,r,e="";if(typeof n=="string"||typeof n=="number")e+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(t=0;t<i;t++)n[t]&&(r=Ve(n[t]))&&(e&&(e+=" "),e+=r)}else for(r in n)n[r]&&(e&&(e+=" "),e+=r);return e}function Wr(){for(var n,t,r=0,e="",i=arguments.length;r<i;r++)(n=arguments[r])&&(t=Ve(n))&&(e&&(e+=" "),e+=t);return e}function jr(n){return typeof n=="object"?Wr(n):n??""}function Kr(n,t,r){var e=n==null?"":""+n;return e===""?null:e}function Qr(n,t,r,e,i,f){var l=n.__className;if(xn||l!==r||l===void 0){var s=Kr(r);(!xn||s!==n.getAttribute("class"))&&(s==null?n.removeAttribute("class"):n.className=s),n.__className=r}return f}function Jr(n,t,r=t){var e=new WeakSet;Dr(n,"input",async i=>{var f=i?n.defaultValue:n.value;if(f=kt(n)?Nt(f):f,r(f),Ln!==null&&e.add(Ln),await Ur(),f!==(f=t())){var l=n.selectionStart,s=n.selectionEnd,h=n.value.length;if(n.value=f??"",s!==null){var g=n.value.length;l===s&&s===h&&g>h?(n.selectionStart=g,n.selectionEnd=g):(n.selectionStart=l,n.selectionEnd=Math.min(s,g))}}}),(xn&&n.defaultValue!==n.value||H(t)==null&&n.value)&&(r(kt(n)?Nt(n.value):n.value),Ln!==null&&e.add(Ln)),Hr(()=>{var i=t();if(n===document.activeElement){var f=Or??Ln;if(e.has(f))return}kt(n)&&i===Nt(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function kt(n){var t=n.type;return t==="number"||t==="range"}function Nt(n){return n===""?null:+n}function ni(n){return function(...t){var r=t[0];return r.stopPropagation(),n?.apply(this,t)}}var _e={},At={},bt=34,Xn=10,Ft=13;function Xe(n){return new Function("d","return {"+n.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function ti(n,t){var r=Xe(n);return function(e,i){return t(r(e),i,n)}}function ye(n){var t=Object.create(null),r=[];return n.forEach(function(e){for(var i in e)i in t||r.push(t[i]=i)}),r}function an(n,t){var r=n+"",e=r.length;return e<t?new Array(t-e+1).join(0)+r:r}function ei(n){return n<0?"-"+an(-n,6):n>9999?"+"+an(n,6):an(n,4)}function ri(n){var t=n.getUTCHours(),r=n.getUTCMinutes(),e=n.getUTCSeconds(),i=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":ei(n.getUTCFullYear())+"-"+an(n.getUTCMonth()+1,2)+"-"+an(n.getUTCDate(),2)+(i?"T"+an(t,2)+":"+an(r,2)+":"+an(e,2)+"."+an(i,3)+"Z":e?"T"+an(t,2)+":"+an(r,2)+":"+an(e,2)+"Z":r||t?"T"+an(t,2)+":"+an(r,2)+"Z":"")}function ii(n){var t=new RegExp('["'+n+`
\r]`),r=n.charCodeAt(0);function e(u,c){var d,v,w=i(u,function(p,E){if(d)return d(p,E-1);v=p,d=c?ti(p,c):Xe(p)});return w.columns=v||[],w}function i(u,c){var d=[],v=u.length,w=0,p=0,E,C=v<=0,T=!1;u.charCodeAt(v-1)===Xn&&--v,u.charCodeAt(v-1)===Ft&&--v;function m(){if(C)return At;if(T)return T=!1,_e;var M,I=w,k;if(u.charCodeAt(I)===bt){for(;w++<v&&u.charCodeAt(w)!==bt||u.charCodeAt(++w)===bt;);return(M=w)>=v?C=!0:(k=u.charCodeAt(w++))===Xn?T=!0:k===Ft&&(T=!0,u.charCodeAt(w)===Xn&&++w),u.slice(I+1,M-1).replace(/""/g,'"')}for(;w<v;){if((k=u.charCodeAt(M=w++))===Xn)T=!0;else if(k===Ft)T=!0,u.charCodeAt(w)===Xn&&++w;else if(k!==r)continue;return u.slice(I,M)}return C=!0,u.slice(I,v)}for(;(E=m())!==At;){for(var x=[];E!==_e&&E!==At;)x.push(E),E=m();c&&(x=c(x,p++))==null||d.push(x)}return d}function f(u,c){return u.map(function(d){return c.map(function(v){return o(d[v])}).join(n)})}function l(u,c){return c==null&&(c=ye(u)),[c.map(o).join(n)].concat(f(u,c)).join(`
`)}function s(u,c){return c==null&&(c=ye(u)),f(u,c).join(`
`)}function h(u){return u.map(g).join(`
`)}function g(u){return u.map(o).join(n)}function o(u){return u==null?"":u instanceof Date?ri(u):t.test(u+="")?'"'+u.replace(/"/g,'""')+'"':u}return{parse:e,parseRows:i,format:l,formatBody:s,formatRows:h,formatRow:g,formatValue:o}}var oi=ii(","),ai=oi.parse,li=pn('<header class="bg-black border-b text-xs"><div class="mx-auto p-1"><div class="text-white"> </div></div></header>');function ui(n,t){let r=K(t,"title",8,"fanzinet"),e=K(t,"subtitle",8,"analogikal knot map"),i=K(t,"version",8,"0.?");var f=li(),l=q(f),s=q(l),h=q(s);O(s),O(l),O(f),sn(()=>_n(h,`${r()??""}
      ${e()??""} v.${i()??""}`)),on(n,f)}var fi=pn('<footer class="bg-black border-t text-xs text-white/70 px-2 py-1"><div class="flex flex-wrap items-center justify-between gap-1"><a target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800"> </a> · <a target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800"> </a></div></footer>');function si(n,t){let r=K(t,"author",8,"Paolo Palmacci"),e=K(t,"authorUrl",8,"https://www.paolopalmacci.it/"),i=K(t,"developer",8,"Giacomo Nanni"),f=K(t,"developerUrl",8,"https://giacomo.website/");var l=fi(),s=q(l),h=q(s),g=q(h,!0);O(h);var o=nn(h,2),u=q(o,!0);O(o),O(s),O(l),sn(()=>{J(h,"href",e()),_n(g,r()),J(o,"href",f()),_n(u,i())}),on(n,l)}class bn{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let e=0;for(let i=0;i<this._n&&i<32;i++){const f=r[i],l=t+f,s=Math.abs(t)<Math.abs(f)?t-(l-f):f-(l-t);s&&(r[e++]=s),t=l}return r[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let r=this._n,e,i,f,l=0;if(r>0){for(l=t[--r];r>0&&(e=l,i=t[--r],l=e+i,f=i-(l-e),!f););r>0&&(f<0&&t[r-1]<0||f>0&&t[r-1]>0)&&(i=f*2,e=l+i,i==e-l&&(l=e))}return l}}function*ci(n){for(const t of n)yield*t}function Ze(n){return Array.from(ci(n))}var V=1e-6,U=Math.PI,tn=U/2,Se=U/4,dn=U*2,gn=180/U,rn=U/180,G=Math.abs,le=Math.atan,Un=Math.atan2,B=Math.cos,vi=Math.exp,qt=Math.log,zt=Math.pow,j=Math.sin,Bn=Math.sign||function(n){return n>0?1:n<0?-1:0},In=Math.sqrt,Be=Math.tan;function di(n){return n>1?0:n<-1?U:Math.acos(n)}function Jn(n){return n>1?tn:n<-1?-tn:Math.asin(n)}function vn(){}function st(n,t){n&&we.hasOwnProperty(n.type)&&we[n.type](n,t)}var Ee={Feature:function(n,t){st(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,e=-1,i=r.length;++e<i;)st(r[e].geometry,t)}},we={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)n=r[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){Vt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)Vt(r[e],t,0)},Polygon:function(n,t){me(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)me(r[e],t)},GeometryCollection:function(n,t){for(var r=n.geometries,e=-1,i=r.length;++e<i;)st(r[e],t)}};function Vt(n,t,r){var e=-1,i=n.length-r,f;for(t.lineStart();++e<i;)f=n[e],t.point(f[0],f[1],f[2]);t.lineEnd()}function me(n,t){var r=-1,e=n.length;for(t.polygonStart();++r<e;)Vt(n[r],t,1);t.polygonEnd()}function $n(n,t){n&&Ee.hasOwnProperty(n.type)?Ee[n.type](n,t):st(n,t)}function Xt(n){return[Un(n[1],n[0]),Jn(n[2])]}function Hn(n){var t=n[0],r=n[1],e=B(r);return[e*B(t),e*j(t),j(r)]}function rt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ct(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Lt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function it(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Zt(n){var t=In(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Bt(n,t){function r(e,i){return e=n(e,i),t(e[0],e[1])}return n.invert&&t.invert&&(r.invert=function(e,i){return e=t.invert(e,i),e&&n.invert(e[0],e[1])}),r}function Gt(n,t){return G(n)>U&&(n-=Math.round(n/dn)*dn),[n,t]}Gt.invert=Gt;function pi(n,t,r){return(n%=dn)?t||r?Bt(Ce(n),Me(t,r)):Ce(n):t||r?Me(t,r):Gt}function xe(n){return function(t,r){return t+=n,G(t)>U&&(t-=Math.round(t/dn)*dn),[t,r]}}function Ce(n){var t=xe(n);return t.invert=xe(-n),t}function Me(n,t){var r=B(n),e=j(n),i=B(t),f=j(t);function l(s,h){var g=B(h),o=B(s)*g,u=j(s)*g,c=j(h),d=c*r+o*e;return[Un(u*i-d*f,o*r-c*e),Jn(d*i+u*f)]}return l.invert=function(s,h){var g=B(h),o=B(s)*g,u=j(s)*g,c=j(h),d=c*i-u*f;return[Un(u*i+c*f,o*r+d*e),Jn(d*r-o*e)]},l}function hi(n,t,r,e,i,f){if(r){var l=B(t),s=j(t),h=e*r;i==null?(i=t+e*dn,f=t-h/2):(i=Pe(l,i),f=Pe(l,f),(e>0?i<f:i>f)&&(i+=e*dn));for(var g,o=i;e>0?o>f:o<f;o-=h)g=Xt([l,-s*B(o),-s*j(o)]),n.point(g[0],g[1])}}function Pe(n,t){t=Hn(t),t[0]-=n,Zt(t);var r=di(-t[1]);return((-t[2]<0?-r:r)+dn-V)%dn}function Ge(){var n=[],t;return{point:function(r,e,i){t.push([r,e,i])},lineStart:function(){n.push(t=[])},lineEnd:vn,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var r=n;return n=[],t=null,r}}}function ft(n,t){return G(n[0]-t[0])<V&&G(n[1]-t[1])<V}function ot(n,t,r,e){this.x=n,this.z=t,this.o=r,this.e=e,this.v=!1,this.n=this.p=null}function We(n,t,r,e,i){var f=[],l=[],s,h;if(n.forEach(function(v){if(!((w=v.length-1)<=0)){var w,p=v[0],E=v[w],C;if(ft(p,E)){if(!p[2]&&!E[2]){for(i.lineStart(),s=0;s<w;++s)i.point((p=v[s])[0],p[1]);i.lineEnd();return}E[0]+=2*V}f.push(C=new ot(p,v,null,!0)),l.push(C.o=new ot(p,null,C,!1)),f.push(C=new ot(E,v,null,!1)),l.push(C.o=new ot(E,null,C,!0))}}),!!f.length){for(l.sort(t),Re(f),Re(l),s=0,h=l.length;s<h;++s)l[s].e=r=!r;for(var g=f[0],o,u;;){for(var c=g,d=!0;c.v;)if((c=c.n)===g)return;o=c.z,i.lineStart();do{if(c.v=c.o.v=!0,c.e){if(d)for(s=0,h=o.length;s<h;++s)i.point((u=o[s])[0],u[1]);else e(c.x,c.n.x,1,i);c=c.n}else{if(d)for(o=c.p.z,s=o.length-1;s>=0;--s)i.point((u=o[s])[0],u[1]);else e(c.x,c.p.x,-1,i);c=c.p}c=c.o,o=c.z,d=!d}while(!c.v);i.lineEnd()}}}function Re(n){if(t=n.length){for(var t,r=0,e=n[0],i;++r<t;)e.n=i=n[r],i.p=e,e=i;e.n=i=n[0],i.p=e}}function $t(n){return G(n[0])<=U?n[0]:Bn(n[0])*((G(n[0])+U)%dn-U)}function gi(n,t){var r=$t(t),e=t[1],i=j(e),f=[j(r),-B(r),0],l=0,s=0,h=new bn;i===1?e=tn+V:i===-1&&(e=-tn-V);for(var g=0,o=n.length;g<o;++g)if(c=(u=n[g]).length)for(var u,c,d=u[c-1],v=$t(d),w=d[1]/2+Se,p=j(w),E=B(w),C=0;C<c;++C,v=m,p=M,E=I,d=T){var T=u[C],m=$t(T),x=T[1]/2+Se,M=j(x),I=B(x),k=m-v,y=k>=0?1:-1,R=y*k,N=R>U,$=p*M;if(h.add(Un($*y*j(R),E*I+$*B(R))),l+=N?k+y*dn:k,N^v>=r^m>=r){var D=ct(Hn(d),Hn(T));Zt(D);var z=ct(f,D);Zt(z);var _=(N^k>=0?-1:1)*Jn(z[2]);(e>_||e===_&&(D[0]||D[1]))&&(s+=N^k>=0?1:-1)}}return(l<-V||l<V&&h<-1e-12)^s&1}function je(n,t,r,e){return function(i){var f=t(i),l=Ge(),s=t(l),h=!1,g,o,u,c={point:d,lineStart:w,lineEnd:p,polygonStart:function(){c.point=E,c.lineStart=C,c.lineEnd=T,o=[],g=[]},polygonEnd:function(){c.point=d,c.lineStart=w,c.lineEnd=p,o=Ze(o);var m=gi(g,e);o.length?(h||(i.polygonStart(),h=!0),We(o,yi,m,r,i)):m&&(h||(i.polygonStart(),h=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),h&&(i.polygonEnd(),h=!1),o=g=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(m,x){n(m,x)&&i.point(m,x)}function v(m,x){f.point(m,x)}function w(){c.point=v,f.lineStart()}function p(){c.point=d,f.lineEnd()}function E(m,x){u.push([m,x]),s.point(m,x)}function C(){s.lineStart(),u=[]}function T(){E(u[0][0],u[0][1]),s.lineEnd();var m=s.clean(),x=l.result(),M,I=x.length,k,y,R;if(u.pop(),g.push(u),u=null,!!I){if(m&1){if(y=x[0],(k=y.length-1)>0){for(h||(i.polygonStart(),h=!0),i.lineStart(),M=0;M<k;++M)i.point((R=y[M])[0],R[1]);i.lineEnd()}return}I>1&&m&2&&x.push(x.pop().concat(x.shift())),o.push(x.filter(_i))}}return c}}function _i(n){return n.length>1}function yi(n,t){return((n=n.x)[0]<0?n[1]-tn-V:tn-n[1])-((t=t.x)[0]<0?t[1]-tn-V:tn-t[1])}const Te=je(function(){return!0},Si,wi,[-U,-tn]);function Si(n){var t=NaN,r=NaN,e=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(f,l){var s=f>0?U:-U,h=G(f-t);G(h-U)<V?(n.point(t,r=(r+l)/2>0?tn:-tn),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(s,r),n.point(f,r),i=0):e!==s&&h>=U&&(G(t-e)<V&&(t-=e*V),G(f-s)<V&&(f-=s*V),r=Ei(t,r,f,l),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(s,r),i=0),n.point(t=f,r=l),e=s},lineEnd:function(){n.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Ei(n,t,r,e){var i,f,l=j(n-r);return G(l)>V?le((j(t)*(f=B(e))*j(r)-j(e)*(i=B(t))*j(n))/(i*f*l)):(t+e)/2}function wi(n,t,r,e){var i;if(n==null)i=r*tn,e.point(-U,i),e.point(0,i),e.point(U,i),e.point(U,0),e.point(U,-i),e.point(0,-i),e.point(-U,-i),e.point(-U,0),e.point(-U,i);else if(G(n[0]-t[0])>V){var f=n[0]<t[0]?U:-U;i=r*f/2,e.point(-f,i),e.point(0,i),e.point(f,i)}else e.point(t[0],t[1])}function mi(n){var t=B(n),r=2*rn,e=t>0,i=G(t)>V;function f(o,u,c,d){hi(d,n,r,c,o,u)}function l(o,u){return B(o)*B(u)>t}function s(o){var u,c,d,v,w;return{lineStart:function(){v=d=!1,w=1},point:function(p,E){var C=[p,E],T,m=l(p,E),x=e?m?0:g(p,E):m?g(p+(p<0?U:-U),E):0;if(!u&&(v=d=m)&&o.lineStart(),m!==d&&(T=h(u,C),(!T||ft(u,T)||ft(C,T))&&(C[2]=1)),m!==d)w=0,m?(o.lineStart(),T=h(C,u),o.point(T[0],T[1])):(T=h(u,C),o.point(T[0],T[1],2),o.lineEnd()),u=T;else if(i&&u&&e^m){var M;!(x&c)&&(M=h(C,u,!0))&&(w=0,e?(o.lineStart(),o.point(M[0][0],M[0][1]),o.point(M[1][0],M[1][1]),o.lineEnd()):(o.point(M[1][0],M[1][1]),o.lineEnd(),o.lineStart(),o.point(M[0][0],M[0][1],3)))}m&&(!u||!ft(u,C))&&o.point(C[0],C[1]),u=C,d=m,c=x},lineEnd:function(){d&&o.lineEnd(),u=null},clean:function(){return w|(v&&d)<<1}}}function h(o,u,c){var d=Hn(o),v=Hn(u),w=[1,0,0],p=ct(d,v),E=rt(p,p),C=p[0],T=E-C*C;if(!T)return!c&&o;var m=t*E/T,x=-t*C/T,M=ct(w,p),I=it(w,m),k=it(p,x);Lt(I,k);var y=M,R=rt(I,y),N=rt(y,y),$=R*R-N*(rt(I,I)-1);if(!($<0)){var D=In($),z=it(y,(-R-D)/N);if(Lt(z,I),z=Xt(z),!c)return z;var _=o[0],b=u[0],A=o[1],F=u[1],Z;b<_&&(Z=_,_=b,b=Z);var yn=b-_,en=G(yn-U)<V,un=en||yn<V;if(!en&&F<A&&(Z=A,A=F,F=Z),un?en?A+F>0^z[1]<(G(z[0]-_)<V?A:F):A<=z[1]&&z[1]<=F:yn>U^(_<=z[0]&&z[0]<=b)){var hn=it(y,(-R+D)/N);return Lt(hn,I),[z,Xt(hn)]}}}function g(o,u){var c=e?n:U-n,d=0;return o<-c?d|=1:o>c&&(d|=2),u<-c?d|=4:u>c&&(d|=8),d}return je(l,s,f,e?[0,-n]:[-U,n-U])}function xi(n,t,r,e,i,f){var l=n[0],s=n[1],h=t[0],g=t[1],o=0,u=1,c=h-l,d=g-s,v;if(v=r-l,!(!c&&v>0)){if(v/=c,c<0){if(v<o)return;v<u&&(u=v)}else if(c>0){if(v>u)return;v>o&&(o=v)}if(v=i-l,!(!c&&v<0)){if(v/=c,c<0){if(v>u)return;v>o&&(o=v)}else if(c>0){if(v<o)return;v<u&&(u=v)}if(v=e-s,!(!d&&v>0)){if(v/=d,d<0){if(v<o)return;v<u&&(u=v)}else if(d>0){if(v>u)return;v>o&&(o=v)}if(v=f-s,!(!d&&v<0)){if(v/=d,d<0){if(v>u)return;v>o&&(o=v)}else if(d>0){if(v<o)return;v<u&&(u=v)}return o>0&&(n[0]=l+o*c,n[1]=s+o*d),u<1&&(t[0]=l+u*c,t[1]=s+u*d),!0}}}}}var Gn=1e9,at=-Gn;function Ci(n,t,r,e){function i(g,o){return n<=g&&g<=r&&t<=o&&o<=e}function f(g,o,u,c){var d=0,v=0;if(g==null||(d=l(g,u))!==(v=l(o,u))||h(g,o)<0^u>0)do c.point(d===0||d===3?n:r,d>1?e:t);while((d=(d+u+4)%4)!==v);else c.point(o[0],o[1])}function l(g,o){return G(g[0]-n)<V?o>0?0:3:G(g[0]-r)<V?o>0?2:1:G(g[1]-t)<V?o>0?1:0:o>0?3:2}function s(g,o){return h(g.x,o.x)}function h(g,o){var u=l(g,1),c=l(o,1);return u!==c?u-c:u===0?o[1]-g[1]:u===1?g[0]-o[0]:u===2?g[1]-o[1]:o[0]-g[0]}return function(g){var o=g,u=Ge(),c,d,v,w,p,E,C,T,m,x,M,I={point:k,lineStart:$,lineEnd:D,polygonStart:R,polygonEnd:N};function k(_,b){i(_,b)&&o.point(_,b)}function y(){for(var _=0,b=0,A=d.length;b<A;++b)for(var F=d[b],Z=1,yn=F.length,en=F[0],un,hn,zn=en[0],Pn=en[1];Z<yn;++Z)un=zn,hn=Pn,en=F[Z],zn=en[0],Pn=en[1],hn<=e?Pn>e&&(zn-un)*(e-hn)>(Pn-hn)*(n-un)&&++_:Pn<=e&&(zn-un)*(e-hn)<(Pn-hn)*(n-un)&&--_;return _}function R(){o=u,c=[],d=[],M=!0}function N(){var _=y(),b=M&&_,A=(c=Ze(c)).length;(b||A)&&(g.polygonStart(),b&&(g.lineStart(),f(null,null,1,g),g.lineEnd()),A&&We(c,s,_,f,g),g.polygonEnd()),o=g,c=d=v=null}function $(){I.point=z,d&&d.push(v=[]),x=!0,m=!1,C=T=NaN}function D(){c&&(z(w,p),E&&m&&u.rejoin(),c.push(u.result())),I.point=k,m&&o.lineEnd()}function z(_,b){var A=i(_,b);if(d&&v.push([_,b]),x)w=_,p=b,E=A,x=!1,A&&(o.lineStart(),o.point(_,b));else if(A&&m)o.point(_,b);else{var F=[C=Math.max(at,Math.min(Gn,C)),T=Math.max(at,Math.min(Gn,T))],Z=[_=Math.max(at,Math.min(Gn,_)),b=Math.max(at,Math.min(Gn,b))];xi(F,Z,n,t,r,e)?(m||(o.lineStart(),o.point(F[0],F[1])),o.point(Z[0],Z[1]),A||o.lineEnd(),M=!1):A&&(o.lineStart(),o.point(_,b),M=!1)}C=_,T=b,m=A}return I}}const Wt=n=>n;var Dt=new bn,jt=new bn,Ke,Qe,Kt,Qt,Cn={point:vn,lineStart:vn,lineEnd:vn,polygonStart:function(){Cn.lineStart=Mi,Cn.lineEnd=Ri},polygonEnd:function(){Cn.lineStart=Cn.lineEnd=Cn.point=vn,Dt.add(G(jt)),jt=new bn},result:function(){var n=Dt/2;return Dt=new bn,n}};function Mi(){Cn.point=Pi}function Pi(n,t){Cn.point=Je,Ke=Kt=n,Qe=Qt=t}function Je(n,t){jt.add(Qt*n-Kt*t),Kt=n,Qt=t}function Ri(){Je(Ke,Qe)}var On=1/0,vt=On,nt=-On,dt=nt,pt={point:Ti,lineStart:vn,lineEnd:vn,polygonStart:vn,polygonEnd:vn,result:function(){var n=[[On,vt],[nt,dt]];return nt=dt=-(vt=On=1/0),n}};function Ti(n,t){n<On&&(On=n),n>nt&&(nt=n),t<vt&&(vt=t),t>dt&&(dt=t)}var Jt=0,ne=0,Wn=0,ht=0,gt=0,Dn=0,te=0,ee=0,jn=0,nr,tr,En,wn,cn={point:Fn,lineStart:Ie,lineEnd:ke,polygonStart:function(){cn.lineStart=Ni,cn.lineEnd=Ai},polygonEnd:function(){cn.point=Fn,cn.lineStart=Ie,cn.lineEnd=ke},result:function(){var n=jn?[te/jn,ee/jn]:Dn?[ht/Dn,gt/Dn]:Wn?[Jt/Wn,ne/Wn]:[NaN,NaN];return Jt=ne=Wn=ht=gt=Dn=te=ee=jn=0,n}};function Fn(n,t){Jt+=n,ne+=t,++Wn}function Ie(){cn.point=Ii}function Ii(n,t){cn.point=ki,Fn(En=n,wn=t)}function ki(n,t){var r=n-En,e=t-wn,i=In(r*r+e*e);ht+=i*(En+n)/2,gt+=i*(wn+t)/2,Dn+=i,Fn(En=n,wn=t)}function ke(){cn.point=Fn}function Ni(){cn.point=bi}function Ai(){er(nr,tr)}function bi(n,t){cn.point=er,Fn(nr=En=n,tr=wn=t)}function er(n,t){var r=n-En,e=t-wn,i=In(r*r+e*e);ht+=i*(En+n)/2,gt+=i*(wn+t)/2,Dn+=i,i=wn*n-En*t,te+=i*(En+n),ee+=i*(wn+t),jn+=i*3,Fn(En=n,wn=t)}function rr(n){this._context=n}rr.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,dn);break}}},result:vn};var re=new bn,Ut,ir,or,Kn,Qn,tt={point:vn,lineStart:function(){tt.point=Fi},lineEnd:function(){Ut&&ar(ir,or),tt.point=vn},polygonStart:function(){Ut=!0},polygonEnd:function(){Ut=null},result:function(){var n=+re;return re=new bn,n}};function Fi(n,t){tt.point=ar,ir=Kn=n,or=Qn=t}function ar(n,t){Kn-=n,Qn-=t,re.add(In(Kn*Kn+Qn*Qn)),Kn=n,Qn=t}let Ne,_t,Ae,be;class Fe{constructor(t){this._append=t==null?lr:zi(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==Ae||this._append!==_t){const e=this._radius,i=this._;this._="",this._append`m0,${e}a${e},${e} 0 1,1 0,${-2*e}a${e},${e} 0 1,1 0,${2*e}z`,Ae=e,_t=this._append,be=this._,this._=i}this._+=be;break}}}result(){const t=this._;return this._="",t.length?t:null}}function lr(n){let t=1;this._+=n[0];for(const r=n.length;t<r;++t)this._+=arguments[t]+n[t]}function zi(n){const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);if(t>15)return lr;if(t!==Ne){const r=10**t;Ne=t,_t=function(i){let f=1;this._+=i[0];for(const l=i.length;f<l;++f)this._+=Math.round(arguments[f]*r)/r+i[f]}}return _t}function Ht(n,t){let r=3,e=4.5,i,f;function l(s){return s&&(typeof e=="function"&&f.pointRadius(+e.apply(this,arguments)),$n(s,i(f))),f.result()}return l.area=function(s){return $n(s,i(Cn)),Cn.result()},l.measure=function(s){return $n(s,i(tt)),tt.result()},l.bounds=function(s){return $n(s,i(pt)),pt.result()},l.centroid=function(s){return $n(s,i(cn)),cn.result()},l.projection=function(s){return arguments.length?(i=s==null?(n=null,Wt):(n=s).stream,l):n},l.context=function(s){return arguments.length?(f=s==null?(t=null,new Fe(r)):new rr(t=s),typeof e!="function"&&f.pointRadius(e),l):t},l.pointRadius=function(s){return arguments.length?(e=typeof s=="function"?s:(f.pointRadius(+s),+s),l):e},l.digits=function(s){if(!arguments.length)return r;if(s==null)r=null;else{const h=Math.floor(s);if(!(h>=0))throw new RangeError(`invalid digits: ${s}`);r=h}return t===null&&(f=new Fe(r)),l},l.projection(n).digits(r).context(t)}function ue(n){return function(t){var r=new ie;for(var e in n)r[e]=n[e];return r.stream=t,r}}function ie(){}ie.prototype={constructor:ie,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fe(n,t,r){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),$n(r,n.stream(pt)),t(pt.result()),e!=null&&n.clipExtent(e),n}function ur(n,t,r){return fe(n,function(e){var i=t[1][0]-t[0][0],f=t[1][1]-t[0][1],l=Math.min(i/(e[1][0]-e[0][0]),f/(e[1][1]-e[0][1])),s=+t[0][0]+(i-l*(e[1][0]+e[0][0]))/2,h=+t[0][1]+(f-l*(e[1][1]+e[0][1]))/2;n.scale(150*l).translate([s,h])},r)}function Li(n,t,r){return ur(n,[[0,0],t],r)}function $i(n,t,r){return fe(n,function(e){var i=+t,f=i/(e[1][0]-e[0][0]),l=(i-f*(e[1][0]+e[0][0]))/2,s=-f*e[0][1];n.scale(150*f).translate([l,s])},r)}function Di(n,t,r){return fe(n,function(e){var i=+t,f=i/(e[1][1]-e[0][1]),l=-f*e[0][0],s=(i-f*(e[1][1]+e[0][1]))/2;n.scale(150*f).translate([l,s])},r)}var ze=16,Ui=B(30*rn);function Le(n,t){return+t?Oi(n,t):Hi(n)}function Hi(n){return ue({point:function(t,r){t=n(t,r),this.stream.point(t[0],t[1])}})}function Oi(n,t){function r(e,i,f,l,s,h,g,o,u,c,d,v,w,p){var E=g-e,C=o-i,T=E*E+C*C;if(T>4*t&&w--){var m=l+c,x=s+d,M=h+v,I=In(m*m+x*x+M*M),k=Jn(M/=I),y=G(G(M)-1)<V||G(f-u)<V?(f+u)/2:Un(x,m),R=n(y,k),N=R[0],$=R[1],D=N-e,z=$-i,_=C*D-E*z;(_*_/T>t||G((E*D+C*z)/T-.5)>.3||l*c+s*d+h*v<Ui)&&(r(e,i,f,l,s,h,N,$,y,m/=I,x/=I,M,w,p),p.point(N,$),r(N,$,y,m,x,M,g,o,u,c,d,v,w,p))}}return function(e){var i,f,l,s,h,g,o,u,c,d,v,w,p={point:E,lineStart:C,lineEnd:m,polygonStart:function(){e.polygonStart(),p.lineStart=x},polygonEnd:function(){e.polygonEnd(),p.lineStart=C}};function E(k,y){k=n(k,y),e.point(k[0],k[1])}function C(){u=NaN,p.point=T,e.lineStart()}function T(k,y){var R=Hn([k,y]),N=n(k,y);r(u,c,o,d,v,w,u=N[0],c=N[1],o=k,d=R[0],v=R[1],w=R[2],ze,e),e.point(u,c)}function m(){p.point=E,e.lineEnd()}function x(){C(),p.point=M,p.lineEnd=I}function M(k,y){T(i=k,y),f=u,l=c,s=d,h=v,g=w,p.point=T}function I(){r(u,c,o,d,v,w,f,l,i,s,h,g,ze,e),p.lineEnd=m,m()}return p}}var Yi=ue({point:function(n,t){this.stream.point(n*rn,t*rn)}});function qi(n){return ue({point:function(t,r){var e=n(t,r);return this.stream.point(e[0],e[1])}})}function Vi(n,t,r,e,i){function f(l,s){return l*=e,s*=i,[t+n*l,r-n*s]}return f.invert=function(l,s){return[(l-t)/n*e,(r-s)/n*i]},f}function $e(n,t,r,e,i,f){if(!f)return Vi(n,t,r,e,i);var l=B(f),s=j(f),h=l*n,g=s*n,o=l/n,u=s/n,c=(s*r-l*t)/n,d=(s*t+l*r)/n;function v(w,p){return w*=e,p*=i,[h*w-g*p+t,r-g*w-h*p]}return v.invert=function(w,p){return[e*(o*w-u*p+c),i*(d-u*w-o*p)]},v}function Xi(n){var t,r=150,e=480,i=250,f=0,l=0,s=0,h=0,g=0,o,u=0,c=1,d=1,v=null,w=Te,p=null,E,C,T,m=Wt,x=.5,M,I,k,y,R;function N(_){return k(_[0]*rn,_[1]*rn)}function $(_){return _=k.invert(_[0],_[1]),_&&[_[0]*gn,_[1]*gn]}N.stream=function(_){return y&&R===_?y:y=Yi(qi(o)(w(M(m(R=_)))))},N.preclip=function(_){return arguments.length?(w=_,v=void 0,z()):w},N.postclip=function(_){return arguments.length?(m=_,p=E=C=T=null,z()):m},N.clipAngle=function(_){return arguments.length?(w=+_?mi(v=_*rn):(v=null,Te),z()):v*gn},N.clipExtent=function(_){return arguments.length?(m=_==null?(p=E=C=T=null,Wt):Ci(p=+_[0][0],E=+_[0][1],C=+_[1][0],T=+_[1][1]),z()):p==null?null:[[p,E],[C,T]]},N.scale=function(_){return arguments.length?(r=+_,D()):r},N.translate=function(_){return arguments.length?(e=+_[0],i=+_[1],D()):[e,i]},N.center=function(_){return arguments.length?(f=_[0]%360*rn,l=_[1]%360*rn,D()):[f*gn,l*gn]},N.rotate=function(_){return arguments.length?(s=_[0]%360*rn,h=_[1]%360*rn,g=_.length>2?_[2]%360*rn:0,D()):[s*gn,h*gn,g*gn]},N.angle=function(_){return arguments.length?(u=_%360*rn,D()):u*gn},N.reflectX=function(_){return arguments.length?(c=_?-1:1,D()):c<0},N.reflectY=function(_){return arguments.length?(d=_?-1:1,D()):d<0},N.precision=function(_){return arguments.length?(M=Le(I,x=_*_),z()):In(x)},N.fitExtent=function(_,b){return ur(N,_,b)},N.fitSize=function(_,b){return Li(N,_,b)},N.fitWidth=function(_,b){return $i(N,_,b)},N.fitHeight=function(_,b){return Di(N,_,b)};function D(){var _=$e(r,0,0,c,d,u).apply(null,t(f,l)),b=$e(r,e-_[0],i-_[1],c,d,u);return o=pi(s,h,g),I=Bt(t,b),k=Bt(o,I),M=Le(I,x),z()}function z(){return y=R=null,N}return function(){return t=n.apply(this,arguments),N.invert=t.invert&&$,D()}}function Zi(n){var t=0,r=U/3,e=Xi(n),i=e(t,r);return i.parallels=function(f){return arguments.length?e(t=f[0]*rn,r=f[1]*rn):[t*gn,r*gn]},i}function fr(n,t){return[n,qt(Be((tn+t)/2))]}fr.invert=function(n,t){return[n,2*le(vi(t))-tn]};function lt(n){return Be((tn+n)/2)}function Bi(n,t){var r=B(n),e=n===t?j(n):qt(r/B(t))/qt(lt(t)/lt(n)),i=r*zt(lt(n),e)/e;if(!e)return fr;function f(l,s){i>0?s<-tn+V&&(s=-tn+V):s>tn-V&&(s=tn-V);var h=i/zt(lt(s),e);return[h*j(e*l),i-h*B(e*l)]}return f.invert=function(l,s){var h=i-s,g=Bn(e)*In(l*l+h*h),o=Un(l,G(h))*Bn(h);return h*e<0&&(o-=U*Bn(l)*Bn(h)),[o/e,2*le(zt(i/g,1/e))-tn]},f}function Gi(){return Zi(Bi).scale(109.5).parallels([30,30])}var Wi=oe('<path fill="#f5f5f5" stroke="#d4d4d8" stroke-width="1.5" vector-effect="non-scaling-stroke"></path>'),ji=oe('<line stroke="#000" stroke-opacity="0.2" stroke-width="1" vector-effect="non-scaling-stroke"></line>'),Ki=oe('<g class="transition-opacity duration-200"><g data-label-hit="" class="cursor-pointer" role="button" tabindex="0"><!><rect fill="black" stroke="black" stroke-width="0" vector-effect="non-scaling-stroke"></rect><text text-anchor="middle" dominant-baseline="middle" font-weight="400" fill="white" class="pointer-events-none select-none" vector-effect="non-scaling-stroke"> </text><title> </title></g></g>'),Qi=pn('<section class="bg-[#ccc]"><div class="absolute top-1 right-1 z-50 space-y-1 text-xs"><button class="bg-white px-2 py-1 font-bold text-black border disabled:opacity-40">+</button> <br/> <button class="bg-white px-2 py-1 font-bold text-black border disabled:opacity-40">−</button></div> <svg class="block h-full w-full cursor-grab touch-none select-none overflow-visible active:cursor-grabbing" preserveAspectRatio="xMidYMid meet" role="application" aria-label="Fanzine map (pan and zoom)"><g><!><!></g></svg></section>');function Ji(n,t){St(t,!1);let r=K(t,"italy",8,null),e=K(t,"points",24,()=>[]);K(t,"filteredItems",24,()=>[]);let i=K(t,"query",8,""),f=K(t,"projectionZoom",8,1.25),l=K(t,"labelPlacements",8,null),s=K(t,"disablePanZoomOnMobile",8,!0),h=K(t,"disableVisibleItems",8,!0),g=K(t,"onSelect",8,null);const o=De(),u=1500,c=1800;let d=W(null),v=W(""),w=W(null),p=W([]),E=W([]),C=W([]);const T=0,m=0;let x=W(1),M=W(T),I=W(m),k=!1,y={x:0,y:0,translateX:0,translateY:0},R=!1,N=W(!1),$=W(!1),D=!1,z=!1,_=null,b=null,A=null,F=W(!1);function Z(P){const S=P.currentTarget?.ownerSVGElement||P.currentTarget;if(!S?.createSVGPoint)return{x:0,y:0};const Y=S.createSVGPoint();Y.x=P.clientX,Y.y=P.clientY;const X=S.getScreenCTM?.();if(!X)return{x:0,y:0};const Q=X.inverse(),ln=Y.matrixTransform(Q);return{x:ln.x,y:ln.y}}function yn(P){const S=P.composedPath?.();return S?S.some(Y=>Y?.dataset&&"labelHit"in Y.dataset):!!P.target?.closest?.("[data-label-hit]")}function en(P,S=u/2,Y=c/2){if(a(F))return;const X=P>0?1.02:1/1.02,Q=Math.max(.5,Math.min(8,a(x)*X));if(Q===a(x))return;const ln=S-(S-a(M))/a(x)*Q,Sn=Y-(Y-a(I))/a(x)*Q;un(ln,Sn,Q)}function un(P,S,Y){if(A={x:P,y:S,scale:Y},typeof requestAnimationFrame>"u"){L(M,A.x),L(I,A.y),L(x,A.scale),A=null;return}b||(b=requestAnimationFrame(()=>{A&&(L(M,A.x),L(I,A.y),L(x,A.scale)),A=null,b=null}))}function hn(){if(!a(d)||!e()||e().length===0){L(C,[]);return}const P=100;L(C,e().filter(S=>{const Y=parseFloat(S.latitude),X=parseFloat(S.longitude);if(!isFinite(Y)||!isFinite(X))return!1;const[Q,ln]=a(d)([X,Y]),Sn=a(M)+Q*a(x),mn=a(I)+ln*a(x);return Sn>-P&&Sn<u+P&&mn>-P&&mn<c+P})),o("visibleItemsChange",a(C))}function zn(P){if(a(F))return;P.preventDefault();const S=P.deltaY>0?-1:1,Y=Z(P);en(S,Y.x,Y.y)}function Pn(P){if(a(F)||P.button!=null&&P.button!==0)return;D=yn(P),k=!1,z=!0,_=P.pointerId,R=!1,L($,!1);const S=Z(P);y={x:S.x,y:S.y,translateX:a(M),translateY:a(I)}}function sr(P){if(a(F)||!z&&!k||_!=null&&P.pointerId!==_)return;const S=Z(P),Y=S.x-y.x,X=S.y-y.y;!R&&Math.hypot(Y,X)>3&&(R=!0,L($,!0),L(N,D),k=!0,yn(P)&&L(N,!0),P.currentTarget.setPointerCapture?.(P.pointerId)),R&&un(y.translateX+Y,y.translateY+X,a(x))}function cr(P){a(F)||wt(P)}function vr(P){a(F)||wt(P,!0)}function wt(P,S=!1){k=!1,z=!1,_=null,P?.currentTarget&&P.currentTarget.releasePointerCapture?.(P.pointerId),R&&!S?(L(N,!0),setTimeout(()=>{L(N,!1),L($,!1)},160)):(L($,!1),L(N,!1)),D=!1,R=!1}function dr(P,S){if(!P||!isFinite(S)||S===1)return;const Y=u/2,X=c/2,[Q,ln]=P.translate();P.scale(P.scale()*S),P.translate([Y+(Q-Y)*S,X+(ln-X)*S])}function pr(P,S){(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),o("select",S))}Nn(()=>(kn(r()),kn(f()),Ht),()=>{if(r()){const P=Gi().parallels([37,45]);P.fitExtent([[0,0],[u,c]],r()),dr(P,f()),L(d,P),L(v,Ht(P)(r())||"");const S=Ht(P).bounds(r());L(w,S?{left:S[0][0],top:S[0][1],right:S[1][0],bottom:S[1][1]}:null)}}),Nn(()=>kn(l()),()=>{l()&&l().length&&L(p,l())}),Nn(()=>(a(p),kn(i()),a(M),a(x),a(I)),()=>{const P=a(p)||[],S=i()?P.filter(X=>{const Q=i().toLowerCase();return X.fanzine?.toLowerCase().includes(Q)||X.city?.toLowerCase().includes(Q)||X.genre?.toLowerCase().includes(Q)}):P,Y=120;L(E,S.filter(X=>{const Q=a(M)+X.x*a(x),ln=a(I)+X.y*a(x);return Q>-Y&&Q<u+Y&&ln>-Y&&ln<c+Y}))}),Nn(()=>(kn(h()),a(C),a(x),a(M),a(I)),()=>{h()?(L(C,[]),o("visibleItemsChange",a(C))):(a(x),a(M),a(I),hn())}),Nn(()=>kn(s()),()=>{if(typeof window<"u"){const P=window.matchMedia?.("(pointer: coarse)")?.matches||window.matchMedia?.("(hover: none)")?.matches;L(F,!!(s()&&P))}}),Ye(),yt();var mt=Qi(),xt=q(mt),Ct=q(xt),se=nn(Ct,4);O(xt);var Rn=nn(xt,2);J(Rn,"viewBox",`0 0 ${u} ${c}`);var Mt=q(Rn),ce=q(Mt);{var hr=P=>{var S=Wi();sn(()=>J(S,"d",a(v))),on(P,S)};An(ce,P=>{a(v)&&P(hr)})}var gr=nn(ce);qe(gr,1,()=>a(E),Xr,(P,S)=>{var Y=Ki(),X=q(Y),Q=q(X);{var ln=Yn=>{var qn=ji();sn(()=>{J(qn,"x1",(a(S),H(()=>a(S).x0))),J(qn,"y1",(a(S),H(()=>a(S).y0))),J(qn,"x2",(a(S),H(()=>a(S).x))),J(qn,"y2",(a(S),H(()=>a(S).y)))}),on(Yn,qn)};An(Q,Yn=>{a(S),H(()=>Math.hypot(a(S).x-a(S).x0,a(S).y-a(S).y0)>6)&&Yn(ln)})}var Sn=nn(Q),mn=nn(Sn),_r=q(mn,!0);O(mn);var ve=nn(mn),yr=q(ve);O(ve),O(X),O(Y),sn(()=>{J(Sn,"x",(a(S),H(()=>a(S).x-a(S).width/2))),J(Sn,"y",(a(S),H(()=>a(S).y-a(S).height/2))),J(Sn,"width",(a(S),H(()=>a(S).width))),J(Sn,"height",(a(S),H(()=>a(S).height))),J(mn,"x",(a(S),H(()=>a(S).x))),J(mn,"y",(a(S),H(()=>a(S).y))),J(mn,"font-size",(a(S),H(()=>a(S).fontSize))),_n(_r,(a(S),H(()=>a(S).text))),_n(yr,`${a(S),H(()=>a(S).fanzine)??""} (${a(S),H(()=>a(S).city)??""})`)}),fn("pointerup",X,ni(()=>{wt(),!a(N)&&!a($)&&!a(F)&&(g()?.(a(S)),o("select",a(S)))})),fn("click",X,()=>{!a(N)&&!a($)&&!a(F)&&(g()?.(a(S)),o("select",a(S)))}),fn("keydown",X,Yn=>pr(Yn,a(S))),on(P,Y)}),O(Mt),O(Rn),O(mt),sn(()=>{Ct.disabled=a(F),se.disabled=a(F),J(Mt,"transform",`translate(${a(M)} ${a(I)}) scale(${a(x)})`)}),fn("click",Ct,()=>en(1)),fn("click",se,()=>en(-1)),fn("wheel",Rn,zn),fn("pointerdown",Rn,Pn),fn("pointermove",Rn,sr),fn("pointerup",Rn,cr),fn("pointercancel",Rn,vr),on(n,mt),Et()}var no=pn('<button type="button" class=" border border-black px-1 py-0.5 text-xs text-black">X</button>'),to=pn('<div class="grid w-full max-w-[280px]"><div class="flex items-center gap-0.5"><input type="text" placeholder="Cerca..." class="flex-1 border border-black bg-white px-1 py-0.5 text-xs text-black outline-none" aria-label="Search fanzines"/> <!></div></div>');function eo(n,t){St(t,!1);let r=K(t,"query",12,"");K(t,"totalCount",8,0),K(t,"visibleCount",8,0),K(t,"resultsCount",8,0);let e=K(t,"hasSelection",8,!1);const i=De();function f(){r(""),i("clear")}yt();var l=to(),s=q(l),h=q(s);Vr(h);var g=nn(h,2);{var o=u=>{var c=no();fn("click",c,f),on(u,c)};An(g,u=>{(r()||e())&&u(o)})}O(s),O(l),Jr(h,r),on(n,l),Et()}var ro=pn('<img class="h-full w-full object-contain" loading="lazy"/>'),io=pn('<div class="mt-0.5 text-[.6rem] leading-snug text-black/60"><div> </div> <button type="button" class="mt-0.5 text-[.6rem] font-medium text-blue-600 hover:text-blue-800"> </button></div>'),oo=pn('<a class=" bg-black/5 px-0.5 py-0 text-[.6rem] hover:bg-black/10" target="_blank" rel="noreferrer">PDF</a>'),ao=pn('<a class=" bg-black/5 px-0.5 py-0 text-[.6rem] text-black hover:bg-black/10" target="_blank" rel="noreferrer">Link</a>'),lo=pn('<div role="listitem" class=" bg-white p-0.5 text-left shadow-sm"><div class="aspect-[3/4] w-full overflow-hidden  bg-black/5"><!></div> <div class="mt-0 mb-0.5 truncate font-bold leading-tight text-[.6rem]"> </div> <div class="truncate leading-tight text-[.6rem]"> </div> <div class="mt-0 line-clamp-2 leading-tight text-[.6rem]"> </div> <!> <div class="mt-0.5 gap-0.5 "><!> <!></div></div>'),uo=pn('<div class="py-0.5"><div class="text-xs leading-tight text-black/70"><strong class="text-black"> </strong> fanzine</div> <div class="grid grid-cols-5 md:grid-cols-12  gap-0.5 p-0.5" role="list" aria-label="Fanzines"></div></div>');function fo(n,t){St(t,!1);let r=K(t,"items",24,()=>[]);const e="https://www.paolopalmacci.it/capitmundi/";let i=W(null);function f(d){return d?/^https?:\/\//i.test(d)?d:`${e}${String(d).replace(/^\/+/,"")}`:""}function l(d){return d?.yearStart?d?.yearEnd&&d.yearEnd!==d.yearStart?`${d.yearStart}-${d.yearEnd}`:String(d.yearStart):""}function s(d,v){const w=[d?.sourceFile,d?.canonicalUrl,d?.pdfHref,d?.title,d?.fanzine,d?.city,d?.yearStart,d?.yearEnd].filter(p=>p!=null&&String(p).trim()!=="").map(p=>String(p));return w.length?`${w.join("|")}|${v}`:String(v)}yt();var h=uo(),g=q(h),o=q(g),u=q(o,!0);O(o),Yr(),O(g);var c=nn(g,2);qe(c,7,r,(d,v)=>s(d,v),(d,v,w)=>{var p=lo(),E=q(p),C=q(E);{var T=A=>{var F=ro();sn(Z=>{J(F,"src",Z),J(F,"alt",(a(v),H(()=>a(v).fanzine||"Fanzine cover")))},[()=>(a(v),H(()=>f(a(v).ogImage)))]),on(A,F)};An(C,A=>{a(v),H(()=>a(v).ogImage)&&A(T)})}O(E);var m=nn(E,2),x=q(m,!0);O(m);var M=nn(m,2),I=q(M);O(M);var k=nn(M,2),y=q(k);O(k);var R=nn(k,2);{var N=A=>{var F=io(),Z=q(F),yn=q(Z,!0);O(Z);var en=nn(Z,2),un=q(en,!0);O(en),O(F),sn(()=>{Qr(Z,1,jr(a(i)===a(w)?"":"line-clamp-3")),_n(yn,(a(v),H(()=>a(v).description))),_n(un,a(i)===a(w)?"Read less":"Read more")}),fn("click",en,()=>{L(i,a(i)===a(w)?null:a(w))}),on(A,F)};An(R,A=>{a(v),H(()=>a(v).description)&&A(N)})}var $=nn(R,2),D=q($);{var z=A=>{var F=oo();sn(Z=>J(F,"href",Z),[()=>(a(v),H(()=>f(a(v).pdfHref)))]),on(A,F)};An(D,A=>{a(v),H(()=>a(v)?.pdfHref)&&A(z)})}var _=nn(D,2);{var b=A=>{var F=ao();sn(()=>J(F,"href",(a(v),H(()=>a(v).canonicalUrl)))),on(A,F)};An(_,A=>{a(v),H(()=>a(v)?.canonicalUrl)&&A(b)})}O($),O(p),sn(A=>{_n(x,(a(v),H(()=>a(v).fanzine))),_n(I,`${a(v),H(()=>a(v).city)??""}${a(v),H(()=>a(v).country?`, ${a(v).country}`:"")??""}`),_n(y,`${a(v),H(()=>a(v).genre||"—")??""}${A??""}`)},[()=>(a(v),H(()=>l(a(v))?` · ${l(a(v))}`:""))]),on(d,p)}),O(c),O(h),sn(()=>_n(u,(kn(r()),H(()=>r().length)))),on(n,h),Et()}var so=pn('<!> <div class="sticky top-0 z-0 h-[65vh] w-full"><div class="h-full w-full overflow-hidden bg-white"><!></div></div> <div class="relative mx-auto bg-white w-full px-2 py-1"><!> <!></div> <!>',1);function So(n,t){St(t,!1);const r=W(),e=W();function i(y){return{sourceFile:y.source_file,canonicalUrl:y.canonical_url,title:y.title,fanzine:y.fanzine||"N/A",city:y.city||"Unknown",country:y.country,activity:y.activity,yearStart:y.year_start,yearEnd:y.year_end,genre:y.genre,description:y.description,pdfHref:y.pdf_href,ogImage:y.og_image,latitude:y.latitude,longitude:y.longitude}}let f=W(null),l=W([]),s=W([]),h=W([]),g=!0,o=W(""),u=W(null),c=W([]);function d(){L(o,""),L(u,null)}function v(y){L(u,y.detail)}function w(y){L(c,y.detail)}Sr(async()=>{try{g=!0;const y=await fetch("/data/italy2.geojson");if(!y.ok)throw new Error("Failed to load geojson");L(f,await y.json());const R=await fetch("/fanzines.csv");if(!R.ok)throw new Error("Failed to load fanzines.csv");const N=await R.text();L(l,ai(N).map(i));try{const $=await fetch("/data/label_placements.json");if($.ok){const D=await $.json();L(h,Array.isArray(D)?D:D.labels||[])}}catch($){console.warn("Failed to load label placements",$)}L(s,a(l).map($=>{const D=parseFloat($.latitude),z=parseFloat($.longitude);return!isFinite(D)||!isFinite(z)?null:{...$,lat:D,lon:z}}).filter(Boolean))}catch(y){y instanceof Error?y.message:String(y)}finally{g=!1}}),Nn(()=>(a(o),a(l)),()=>{L(r,a(o)?a(l).filter(y=>{const R=a(o).toLowerCase();return y.fanzine?.toLowerCase().includes(R)||y.city?.toLowerCase().includes(R)||y.genre?.toLowerCase().includes(R)}):[])}),Nn(()=>(a(o),a(s)),()=>{L(e,a(o)?a(s).filter(y=>{const R=a(o).toLowerCase();return y.fanzine?.toLowerCase().includes(R)||y.city?.toLowerCase().includes(R)||y.genre?.toLowerCase().includes(R)}).length:a(s).length)}),Ye(),yt();var p=so(),E=qr(p);ui(E,{});var C=nn(E,2),T=q(C),m=q(T);{let y=ut(()=>a(u)?[a(u)]:a(o)?a(r):a(l));Ji(m,{get italy(){return a(f)},get points(){return a(s)},get labelPlacements(){return a(h)},get query(){return a(o)},projectionZoom:1,get filteredItems(){return a(y)},$$events:{select:v,visibleItemsChange:w}})}O(T),O(C);var x=nn(C,2),M=q(x);{let y=ut(()=>!!a(u));eo(M,{get totalCount(){return a(l),H(()=>a(l).length)},get visibleCount(){return a(e)},get resultsCount(){return a(r),H(()=>a(r).length)},get hasSelection(){return a(y)},get query(){return a(o)},set query(R){L(o,R)},$$events:{clear:d},$$legacy:!0})}var I=nn(M,2);{let y=ut(()=>(a(u),a(o),a(r),a(c),a(l),H(()=>a(u)?[a(u)]:a(o)?a(r):a(c).length>0?a(c):a(l))));fo(I,{get items(){return a(y)}})}O(x);var k=nn(x,2);si(k,{}),on(n,p),Et()}export{So as component};
